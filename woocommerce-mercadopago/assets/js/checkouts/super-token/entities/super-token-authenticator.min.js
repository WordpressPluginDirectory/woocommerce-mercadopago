class MPSuperTokenAuthenticator{AMOUNT_ELEMENT_ID="mp-amount";PLATFORM_ID=wc_mercadopago_supertoken_bundle_params.platform_id;SUPER_TOKEN_VALIDATION_ELEMENT_ID="super_token_validation";AUTHORIZED_PSEUDOTOKEN_ELEMENT_ID="authorized_pseudotoken";amountUsed=null;authenticator=null;fastPaymentToken=null;mpSdkInstance=null;mpSuperTokenPaymentMethods=null;mpSuperTokenMetrics=null;constructor(t,e,r){this.mpSdkInstance=t,this.mpSuperTokenPaymentMethods=e,this.mpSuperTokenMetrics=r}reset(){this.authenticator=null,this.fastPaymentToken=null}setSuperTokenValidation(t){const e=document.getElementById(this.SUPER_TOKEN_VALIDATION_ELEMENT_ID);e&&(e.value=t?"true":"false")}getAmountUsed(){return this.amountUsed}storeAuthenticator(t){this.authenticator=t}getStoredAuthenticator(){return this.authenticator}storeFastPaymentToken(t){this.fastPaymentToken=t}getStoredFastPaymentToken(){return this.fastPaymentToken}formatAmount(t=""){const e=t?.replace(/[^\d.,]/g,"");if(!e)return null;const r=e.lastIndexOf(",")>e.lastIndexOf("."),n=e.replace(/[.,]/g,((t,e)=>r?","===t?".":"":"."===t?".":"")),o=parseFloat(n);return isNaN(o)?null:o.toFixed(2)}async buildAuthenticator(t,e){try{this.amountUsed=t;return await this.mpSdkInstance.authenticator(t,e,{platformId:this.PLATFORM_ID,version:2})}catch(t){return this.mpSuperTokenMetrics.errorToBuildAuthenticator(t),null}}async getSimplifiedAuth(t){try{return!!t&&await t.getSimplifiedAuth()}catch(t){return this.mpSuperTokenMetrics.errorToGetSimplifiedAuth(t),!1}}async getFastPaymentToken(t){try{return t?await t.getFastPaymentToken():null}catch(t){return this.mpSuperTokenMetrics.errorToGetFastPaymentToken(t),null}}storeAuthorizedPseudotoken(t){const e=document.getElementById(this.AUTHORIZED_PSEUDOTOKEN_ELEMENT_ID);this.mpSuperTokenMetrics.registerAuthorizedPseudotoken(t,!!e),e&&(e.value=t)}async getAccountPaymentMethods(t,e){try{const r=await this.buildAuthenticator(t,e);if(!r)return null;this.storeAuthenticator(r);if(!await this.getSimplifiedAuth(r))return null;document.dispatchEvent(new CustomEvent("mp-behavior-tracking-super-token-init")),this.mpSuperTokenMetrics.canUseSuperToken(!0);const n=await this.getFastPaymentToken(r);if(!n)return null;this.storeFastPaymentToken(n);const o=await this.mpSuperTokenPaymentMethods.getAccountPaymentMethods(n);if(!o?.data?.length)throw new Error(MPSuperTokenErrorCodes.EMPTY_ACCOUNT_PAYMENT_METHODS);return o.data}catch(t){return this.mpSuperTokenMetrics.errorToGetAccountPaymentMethods(t),null}}async authorizePayment(t){try{const e=this.getStoredAuthenticator();if(!e)throw new Error(MPSuperTokenErrorCodes.AUTHENTICATOR_NOT_FOUND);if(!await this.getSimplifiedAuth(e))return;await e.authorizePayment(t),this.storeAuthorizedPseudotoken(t)}catch(t){if(this.mpSuperTokenMetrics.errorToAuthorizePayment(t),t?.message?.includes("USER_CANCELLED"))throw new Error(MPSuperTokenErrorCodes.AUTHORIZE_PAYMENT_METHOD_USER_CANCELLED);throw new Error(MPSuperTokenErrorCodes.AUTHORIZE_PAYMENT_METHOD_ERROR)}}}