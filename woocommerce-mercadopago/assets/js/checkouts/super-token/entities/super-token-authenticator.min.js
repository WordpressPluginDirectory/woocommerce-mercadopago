class MPSuperTokenAuthenticator{AMOUNT_ELEMENT_ID="mp-amount";PLATFORM_ID=wc_mercadopago_supertoken_authenticator_params.platform_id;amountUsed=null;authenticator=null;fastPaymentToken=null;mpSdkInstance=null;mpSuperTokenPaymentMethods=null;mpSuperTokenMetrics=null;constructor(t,e,r){this.mpSdkInstance=t,this.mpSuperTokenPaymentMethods=e,this.mpSuperTokenMetrics=r}reset(){this.authenticator=null,this.fastPaymentToken=null}getAmountUsed(){return this.amountUsed}storeAuthenticator(t){this.authenticator=t}getStoredAuthenticator(){return this.authenticator}storeFastPaymentToken(t){this.fastPaymentToken=t}getStoredFastPaymentToken(){return this.fastPaymentToken}formatAmount(t=""){const e=t?.replace(/[^\d.,]/g,"");if(!e)return null;const r=e.lastIndexOf(",")>e.lastIndexOf("."),n=e.replace(/[.,]/g,((t,e)=>r?","===t?".":"":"."===t?".":"")),a=parseFloat(n);return isNaN(a)?null:a.toFixed(2)}async buildAuthenticator(t,e){try{this.amountUsed=t;return await this.mpSdkInstance.authenticator(t,e,{platformId:this.PLATFORM_ID,version:2})}catch(t){return this.mpSuperTokenMetrics.errorToBuildAuthenticator(t),null}}async getSimplifiedAuth(t){try{return!!t&&await t.getSimplifiedAuth()}catch(t){return this.mpSuperTokenMetrics.errorToGetSimplifiedAuth(t),!1}}async getFastPaymentToken(t){try{return t?await t.getFastPaymentToken():null}catch(t){return this.mpSuperTokenMetrics.errorToGetFastPaymentToken(t),null}}async getAccountPaymentMethods(t,e){try{const r=await this.buildAuthenticator(t,e);if(!r)return null;this.storeAuthenticator(r);if(!await this.getSimplifiedAuth(r))return null;document.dispatchEvent(new CustomEvent("mp-behavior-tracking-super-token-init")),this.mpSuperTokenMetrics.canUseSuperToken(!0);const n=await this.getFastPaymentToken(r);if(!n)return null;this.storeFastPaymentToken(n);const a=await this.mpSuperTokenPaymentMethods.getAccountPaymentMethods(n);if(!a?.data?.length)throw new Error(MPSuperTokenErrorCodes.EMPTY_ACCOUNT_PAYMENT_METHODS);return a.data}catch(t){return this.mpSuperTokenMetrics.errorToGetAccountPaymentMethods(t),null}}async authorizePayment(t){try{const e=this.getStoredAuthenticator();if(!e)throw new Error(MPSuperTokenErrorCodes.AUTHENTICATOR_NOT_FOUND);if(!await this.getSimplifiedAuth(e))return;await e.authorizePayment(t)}catch(t){throw this.mpSuperTokenMetrics.errorToAuthorizePayment(t),new Error(MPSuperTokenErrorCodes.AUTHORIZE_PAYMENT_METHOD_ERROR)}}}