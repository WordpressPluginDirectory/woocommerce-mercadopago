class MPSuperTokenAuthenticator{AMOUNT_ELEMENT_ID="mp-amount";PLATFORM_ID=wc_mercadopago_supertoken_authenticator_params.platform_id;ableToUseSuperToken=null;amountUsed=null;authenticator=null;userClosedModal=!1;mpSdkInstance=null;mpSuperTokenPaymentMethods=null;mpSuperTokenMetrics=null;constructor(e,t,o){this.mpSdkInstance=e,this.mpSuperTokenPaymentMethods=t,this.mpSuperTokenMetrics=o}getAmountUsed(){return this.amountUsed}isUserModalClosure(e){return"NO_BOTTOMSHEET_CONFIRMATION"===e?.errorCode}storeUserClosedModal(){this.userClosedModal=!0}isUserClosedModal(){return this.userClosedModal}async buildAuthenticator(e,t){this.amountUsed=e;return await this.mpSdkInstance.authenticator(e,t,{platformId:this.PLATFORM_ID})}async canUseSuperTokenFlow(e,t){try{const o=await this.buildAuthenticator(e,t);return this.ableToUseSuperToken=!0,this.mpSuperTokenMetrics.canUseSuperToken(!0),!!o}catch(e){return this.ableToUseSuperToken=!1,!1}}async renderAccountPaymentMethods(e){try{const t=await this.mpSuperTokenPaymentMethods.getAccountPaymentMethods(e);if(!t?.data.length)throw new Error("No payment methods found");this.mpSuperTokenPaymentMethods.renderAccountPaymentMethods(t.data,this.amountUsed)}catch(e){this.mpSuperTokenMetrics.errorToRenderAccountPaymentMethods(e)}}async showAuthenticator(e){try{const t=await e.show();await this.renderAccountPaymentMethods(t)}catch(e){this.isUserModalClosure(e)&&this.storeUserClosedModal(),this.mpSuperTokenMetrics.errorToShowAuthenticator(e)}}async authenticate(e,t){if(!1===this.ableToUseSuperToken)return;const o=await this.buildAuthenticator(e,t);this.mpSuperTokenMetrics.canUseSuperToken(!0),await this.showAuthenticator(o)}}