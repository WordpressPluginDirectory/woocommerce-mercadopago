class MPSuperTokenMetrics{PLATFORM_NAME="woocommerce";CORE_MONITOR_URL="https://api.mercadopago.com/ppcore/prod/monitor/v1/event/datadog/big";MELIDATA_ERROR_EVENT_NAME="mp_checkout_error";PLUGIN_VERSION=wc_mercadopago_supertoken_metrics_params.plugin_version;PLATFORM_VERSION=wc_mercadopago_supertoken_metrics_params.platform_version;SITE_ID=wc_mercadopago_supertoken_metrics_params.site_id;CUST_ID=wc_mercadopago_supertoken_metrics_params.cust_id;LOCATION=wc_mercadopago_supertoken_metrics_params.location;CUSTOM_CHECKOUT_STEPS={LOAD_SUPER_TOKEN:"load_super_token",SELECT_PAYMENT_METHOD:"select_payment_method",POST_SUBMIT:"post_submit"};mpSdkInstance=null;constructor(e){this.mpSdkInstance=e}getSdkInstanceId(){try{return this?.mpSdkInstance?.getSDKInstanceId()||"Unknown"}catch(e){return"Unknown"}}getEnvironment(){return"prod"}sendMetric(e,r,t){fetch(`${this.CORE_MONITOR_URL}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:`${r}`,message:`${t}`,plugin_version:this.PLUGIN_VERSION,platform:{name:this.PLATFORM_NAME,uri:window.location.href,version:this.PLATFORM_VERSION,url:`${this.LOCATION}${this.THEME?`_${this.THEME}`:""}`},details:{site_id:this.SITE_ID,environment:this.getEnvironment(),sdk_instance_id:this.getSdkInstanceId(),cust_id:this.CUST_ID}})}).catch((e=>console.error("Super Token metrics error: ",e)))}dispatchMelidataErrorEvent(e,r){document.dispatchEvent(new CustomEvent(this.MELIDATA_ERROR_EVENT_NAME,{detail:{message:e,errorOrigin:r}}))}normalizeErrorMessage(e){if(!e)return"Unknown error";const r=e?.message||`${JSON.stringify(e)}`;return(r?.includes("invalid_email_address_provided")?"invalid_email_address_provided":r)||"Unknown error"}canUseSuperToken(e,r=null){const t=this.normalizeErrorMessage(r);this.sendMetric("can_use_super_token",e,t)}errorToAuthorizePayment(e){const r=this.normalizeErrorMessage(e);this.dispatchMelidataErrorEvent(r,this.CUSTOM_CHECKOUT_STEPS.POST_SUBMIT),this.sendMetric("error_to_authorize_payment","true",r)}errorToGetSimplifiedAuth(e){const r=this.normalizeErrorMessage(e);this.dispatchMelidataErrorEvent(r,this.CUSTOM_CHECKOUT_STEPS.LOAD_SUPER_TOKEN),this.sendMetric("error_to_get_simplified_auth","true",r)}errorToGetFastPaymentToken(e){const r=this.normalizeErrorMessage(e);this.dispatchMelidataErrorEvent(r,this.CUSTOM_CHECKOUT_STEPS.LOAD_SUPER_TOKEN),this.sendMetric("error_to_get_fast_payment_token","true",r)}errorToBuildAuthenticator(e){const r=this.normalizeErrorMessage(e);this.dispatchMelidataErrorEvent(r,this.CUSTOM_CHECKOUT_STEPS.LOAD_SUPER_TOKEN),this.shouldSkipError(r)||this.sendMetric("error_to_build_authenticator","true",r)}errorToMountCVVField(e,r){const t=this.normalizeErrorMessage(e);this.dispatchMelidataErrorEvent(t,this.CUSTOM_CHECKOUT_STEPS.SELECT_PAYMENT_METHOD),this.sendMetric("error_to_mount_cvv_field",r?.id||"Unknown payment method",t)}errorToUpdateSecurityCode(e,r){const t=this.normalizeErrorMessage(e);this.dispatchMelidataErrorEvent(t,this.CUSTOM_CHECKOUT_STEPS.POST_SUBMIT),this.sendMetric("error_to_update_security_code",r?.token||"Unknown payment method token",t)}errorOnSubmit(e,r){const t=this.normalizeErrorMessage(r);this.dispatchMelidataErrorEvent(t,this.CUSTOM_CHECKOUT_STEPS.POST_SUBMIT),this.shouldSkipError(t)||this.sendMetric("error_on_submit_super_token",e,t)}shouldSkipError(e){if(!e)return!1;const r=("string"!=typeof e?`${e}`:e).replace(/\[mercado pago\]:\s*/gi,"").trim().toLowerCase();return MPSuperTokenSkippableErrorMessages.some((e=>e instanceof RegExp?e.test(r):r.includes(e)))}errorToGetAccountPaymentMethods(e){const r=this.normalizeErrorMessage(e);this.dispatchMelidataErrorEvent(r,this.CUSTOM_CHECKOUT_STEPS.LOAD_SUPER_TOKEN),this.shouldSkipError(r)||this.sendMetric("error_to_get_account_payment_methods","true",r)}registerClickOnPlaceOrderButton(){this.sendMetric("super_token_click_on_place_order_button","true","")}registerAuthorizedPseudotoken(e,r){this.sendMetric("authorized_pseudotoken",e,"input_exists:"+(r?"true":"false"))}}