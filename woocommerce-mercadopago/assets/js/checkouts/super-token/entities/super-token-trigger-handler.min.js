class MPSuperTokenTriggerHandler{CUSTOM_CHECKOUT_BLOCKS_RADIO_SELECTOR="[value=woo-mercado-pago-custom]";CUSTOM_CHECKOUT_CLASSIC_RADIO_SELECTOR="#payment_method_woo-mercado-pago-custom";CUSTOM_CHECKOUT_CLASSIC_SELECTOR=".payment_method_woo-mercado-pago-custom";CUSTOM_CHECKOUT_CONTAINER_ID="mp-custom-checkout-form-container";CLICKABLE_AREA_STARTS_ID="mp-super-token-clickable-area";CARD_NUMBER_FIELD_ID="form-checkout__cardNumber-container";CARD_HOLDER_NAME_FIELD_ID="form-checkout__cardholderName";EXPIRATION_DATE_FIELD_ID="form-checkout__expirationDate-container";SECURITY_CODE_FIELD_ID="form-checkout__securityCode-container";wcBuyerEmail=null;currentAmount=null;isAlreadyListeningForm=!1;mpSuperTokenAuthenticator=null;wcEmailListener=null;mpSuperTokenPaymentMethods=null;constructor(e,t,o){this.mpSuperTokenAuthenticator=e,this.wcEmailListener=t,this.mpSuperTokenPaymentMethods=o}reset(){this.removeClickableAreas()}amountHasChanged(){return null!=this.currentAmount&&null!=this.mpSuperTokenAuthenticator.getAmountUsed()&&this.currentAmount!==this.mpSuperTokenAuthenticator.getAmountUsed()}isDifferentEmail(e){return this.wcBuyerEmail!=e}getCustomCheckoutRadioElement(){return document.querySelector(this.CUSTOM_CHECKOUT_BLOCKS_RADIO_SELECTOR)||document.querySelector(this.CUSTOM_CHECKOUT_CLASSIC_RADIO_SELECTOR)}isClassicCheckout(){return!!document.querySelector(this.CUSTOM_CHECKOUT_CLASSIC_SELECTOR)}getAmount(){const e=this.getCartTotalFromHTML();if(e)return e;const t=document.getElementById("mp-amount");if(!t)return null;const o=parseFloat(t?.value?.replace(",",".")).toFixed(2);return String(o)}getCartTotalFromHTML(){const e=document.querySelector(".wc-block-components-totals-wrapper .wc-block-components-totals-item__value .wc-block-components-formatted-money-amount");if(!e||!e?.textContent)return null;const t=e.textContent.replace(/[^\d.,]/g,"");if(!/,\d{2}$/.test(t))return null;const o=parseFloat(t.replace(/\./g,"").replace(",","."));return o?.toFixed(2)}customCheckoutIsEnable(){return!!this.getCustomCheckoutRadioElement()}customCheckoutIsActive(){return this.getCustomCheckoutRadioElement()?.checked}alreadyHasClickableArea(){return!!document.querySelector(`[id^=${this.CLICKABLE_AREA_STARTS_ID}]`)}shouldCreateClickableArea(){return this.customCheckoutIsActive()&&!this.alreadyHasClickableArea()}getMercadoPagoCustomCheckoutContainerElement(){return document.getElementById(this.CUSTOM_CHECKOUT_CONTAINER_ID)}getCreditCardFormFields(){return[document.getElementById(this.CARD_NUMBER_FIELD_ID),document.getElementById(this.CARD_HOLDER_NAME_FIELD_ID),document.getElementById(this.EXPIRATION_DATE_FIELD_ID),document.getElementById(this.SECURITY_CODE_FIELD_ID)]}createClickableArea(e){const t=document.createElement("div");t.id=this.CLICKABLE_AREA_STARTS_ID+e.id,t.addEventListener("click",this.onTrigger.bind(this),{once:!0}),e.style.pointerEvents="none",e.id.includes("holderName")&&(e.style.width="100%",e.style.boxSizing="border-box !important"),e.parentNode.replaceChild(t,e),t.appendChild(e)}removeClickableAreas(){document.querySelectorAll(`[id^=${this.CLICKABLE_AREA_STARTS_ID}]`).forEach((e=>{e.firstChild.style.pointerEvents="auto",e.replaceWith(e.firstChild)}))}onTrigger(){this.removeClickableAreas();const e=this.wcBuyerEmail||this.wcEmailListener.getEmail();this.mpSuperTokenAuthenticator.authenticate(this.currentAmount,e)}resetFlow(){this.reset(),this.mpSuperTokenPaymentMethods.reset()}resetCustomCheckout(){this.mpSuperTokenPaymentMethods.hasStoredPaymentMethods()&&(this.mpSuperTokenPaymentMethods.unmountCardForm(),this.mpSuperTokenPaymentMethods.mountCardForm()),this.resetFlow(),this.loadSuperToken(this.getAmount()),document.querySelector(this.mpSuperTokenPaymentMethods.CHECKOUT_CONTAINER_SELECTOR).style.height="auto"}resetSuperTokenOnError(){"super_token"===document.querySelector("#mp_checkout_type")?.value&&(console.log("Resetting ST flow due to checkout error"),this.resetCustomCheckout(),document.querySelector("#mp_checkout_type").value="")}isSuperTokenPaymentMethodsLoaded(){return this.mpSuperTokenPaymentMethods.hasStoredPaymentMethods()}async loadSuperToken(e=this.getAmount()){this.mpSuperTokenAuthenticator.isUserClosedModal()||(this.currentAmount=e,this.amountHasChanged()&&this.resetFlow(),this.isSuperTokenPaymentMethodsLoaded()?this.mpSuperTokenPaymentMethods.renderAccountPaymentMethods(this.mpSuperTokenPaymentMethods.getStoredPaymentMethods()):(this.shouldCreateClickableArea()&&this.getCreditCardFormFields().forEach((e=>{this.createClickableArea(e)})),this.isAlreadyListeningForm||(this.wcEmailListener.onEmailChange((async(t,o)=>{if(this.isDifferentEmail(t)&&null!=this.wcBuyerEmail)return this.wcBuyerEmail=t,void this.resetCustomCheckout();if(this.wcBuyerEmail=t,o&&e){await this.mpSuperTokenAuthenticator.canUseSuperTokenFlow(e,t)||this.removeClickableAreas()}})),this.wcEmailListener.setupEmailChangeHandlers(),this.isAlreadyListeningForm=!0)))}}