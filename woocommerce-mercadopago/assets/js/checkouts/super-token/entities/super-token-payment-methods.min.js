class MPSuperTokenPaymentMethods{SUPER_TOKEN_CHECKOUT_TYPE="super_token";CUSTOM_CHECKOUT_TYPE="custom";COUNTRIES_WITH_BANK_INTEREST_DISCLAIMER=["MCO","MPE","MLC"];CUSTOM_CHECKOUT_BLOCKS_SELECTOR="#radio-control-wc-payment-method-options-woo-mercado-pago-custom__content";CUSTOM_CHECKOUT_CLASSIC_SELECTOR=".payment_box.payment_method_woo-mercado-pago-custom";WALLET_BUTTON_SELECTOR=".mp-wallet-button-container";CHECKOUT_CUSTOM_CONTAINER_SELECTOR=".mp-checkout-custom-container";CHECKOUT_CONTAINER_SELECTOR=".mp-checkout-container";CHECKOUT_TYPE_SELECTOR="#mp_checkout_type";CLICKABLE_AREA_STARTS_ID="mp-super-token-clickable-area";COLOMBIA_ACCRONYM="MCO";MEXICO_ACCRONYM="MLM";SUPER_TOKEN_STYLES={ACCORDION:"mp-super-token-payment-method__accordion",ACCORDION_HEADER:"mp-super-token-payment-method__accordion-header",ACCORDION_TITLE:"mp-super-token-payment-method__accordion-title",ACCORDION_CONTENT:"mp-super-token-payment-method__accordion-content",THUMBNAIL:"mp-super-token-payment-method__thumbnail",PAYMENT_METHOD_LIST:"mp-super-token-payment-methods-list",PAYMENT_METHOD:"mp-super-token-payment-method",PAYMENT_METHOD_CONTENT:"mp-super-token-payment-method__content",PAYMENT_METHOD_TITLE:"mp-super-token-payment-method__title",PAYMENT_METHOD_DESCRIPTION:"mp-super-token-payment-method__description",PAYMENT_METHOD_LAST_FOUR_DIGITS:"mp-super-token-payment-method__last-four-digits",PAYMENT_METHOD_SECURITY_CODE_FIELDS:"mp-super-token-payment-method__security-code-fields",PAYMENT_METHOD_SECURITY_CODE:"mp-super-token-payment-method__security-code",PAYMENT_METHOD_EXPIRATION_DATE:"mp-super-token-payment-method__expiration-date",PAYMENT_METHOD_SELECTED:"mp-super-token-payment-method__selected",PAYMENT_METHOD_ACCORDION:"mp-super-token-payment-method__accordion",PAYMENT_METHOD_THUMBNAIL:"mp-super-token-payment-method__thumbnail",PAYMENT_METHOD_ACCORDION_CONTENT_OPEN:"mp-super-token-payment-method__accordion-content--open",PAYMENT_METHOD_VALUE_PROP:"mp-super-token-payment-method__value-prop",PAYMENT_METHOD_DETAILS:"mp-super-token-payment-method__details",PAYMENT_METHOD_HEADER:"mp-super-token-payment-method__header",PAYMENT_METHOD_HIDE:"mp-super-token-hide",REMOVE_BOX_SHADOW:"mp-box-shadow-none"};YELLOW_WALLET_PATH=wc_mercadopago_supertoken_payment_methods_params.yellow_wallet_path;WHITE_CARD_PATH=wc_mercadopago_supertoken_payment_methods_params.white_card_path;PAYMENT_METHODS_LIST_TEXT=wc_mercadopago_supertoken_payment_methods_params.payment_methods_list_text;LAST_DIGITS_TEXT=wc_mercadopago_supertoken_payment_methods_params.last_digits_text;NEW_CARD_TEXT=wc_mercadopago_supertoken_payment_methods_params.new_card_text;ACCOUNT_MONEY_TEXT=wc_mercadopago_supertoken_payment_methods_params.account_money_text;ACCOUNT_MONEY_INVESTED_TEXT=wc_mercadopago_supertoken_payment_methods_params.account_money_invested_text;INTEREST_FREE_PART_ONE_TEXT=wc_mercadopago_supertoken_payment_methods_params.interest_free_part_one_text;INTEREST_FREE_PART_TWO_TEXT=wc_mercadopago_supertoken_payment_methods_params.interest_free_part_two_text;BANK_INTEREST_OPTION_TEXT=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.bank_interest_option_text;BANK_INTEREST_HINT_TEXT=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.bank_interest_hint_text;INSTALLMENTS_INPUT_TITLE=wc_mercadopago_supertoken_payment_methods_params.input_title.installments;INSTALLMENTS_PLACEHOLDER=wc_mercadopago_supertoken_payment_methods_params.placeholders.installments;INSTALLMENTS_REQUIRED_MESSAGE=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.required;INSTALLMENTS_HINT_TEXT=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.hint;INSTALLMENTS_INTEREST_FREE_OPTION_TEXT=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.interest_free_option_text;SECURITY_CODE_INPUT_TITLE_TEXT=wc_mercadopago_supertoken_payment_methods_params.security_code_input_title_text;SECURITY_CODE_PLACEHOLDER_TEXT_3_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_placeholder_text_3_digits;SECURITY_CODE_PLACEHOLDER_TEXT_4_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_placeholder_text_4_digits;SECURITY_CODE_ERROR_MESSAGES=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.securityCode;SECURITY_CODE_TOOLTIP_TEXT_3_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_tooltip_text_3_digits;SECURITY_CODE_TOOLTIP_TEXT_4_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_tooltip_text_4_digits;SITE_ID=wc_mercadopago_supertoken_payment_methods_params.site_id;CURRENCY=wc_mercadopago_supertoken_payment_methods_params.currency;INTL=wc_mercadopago_supertoken_payment_methods_params.intl;MERCADO_PAGO_CARD_NAME=wc_mercadopago_supertoken_payment_methods_params.mercado_pago_card_name;NEW_CARD_TYPE="new_card";CREDIT_CARD_TYPE="credit_card";DEBIT_CARD_TYPE="debit_card";ACCOUNT_MONEY_TYPE="account_money";PREPAID_CARD_TYPE="prepaid_card";PAYMENT_METHODS_ORDER=wc_mercadopago_supertoken_payment_methods_params.payment_methods_order;PAYMENT_METHODS_ORDER_TYPE_CARDS_FIRST="cards_first";PAYMENT_METHODS_ORDER_TYPE_ACCOUNT_MONEY_FIRST="account_money_first";PAYMENT_METHODS_THUMBNAILS=wc_mercadopago_supertoken_payment_methods_params.payment_methods_thumbnails;paymentMethods=[];superToken=null;securityFieldsActiveInstance=null;activePaymentMethod=null;amount=null;mpSdkInstance=null;mpSuperTokenMetrics=null;constructor(e,t){this.mpSdkInstance=e,this.mpSuperTokenMetrics=t}reset(){this.paymentMethods=[],this.showWalletButton(),this.removePaymentMethodElements(),this.removeAccordion(),this.deselectAllPaymentMethods(),this.removePaymentMethodsListClasses()}storePaymentMethodsInMemory(e){this.paymentMethods=e}getStoredPaymentMethods(){return this.paymentMethods}hasStoredPaymentMethods(){return this.paymentMethods.length>0}setSuperToken(e){this.superToken=e}getSuperToken(){return this.superToken}paymentMethodsAreRendered(){return!!document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD}`)}removeClickableAreas(){document.querySelectorAll(`[id^=${this.CLICKABLE_AREA_STARTS_ID}]`).forEach((e=>{e.firstChild.style.pointerEvents="auto",e.replaceWith(e.firstChild)}))}async getAccountPaymentMethods(e){return this.setSuperToken(e),this.mpSdkInstance.getAccountPaymentMethods(e)}getCustomCheckoutEntireElement(){return document.querySelector(this.CUSTOM_CHECKOUT_BLOCKS_SELECTOR)||document.querySelector(this.CUSTOM_CHECKOUT_CLASSIC_SELECTOR)}getWalletButtonElement(){return document.querySelector(this.WALLET_BUTTON_SELECTOR)}hideWalletButton(){const e=this.getWalletButtonElement();e&&(e.style.display="none")}showWalletButton(){const e=this.getWalletButtonElement();e&&(e.style.display="flex")}removeAccordion(){const e=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION}`),t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION_HEADER}`);e?.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR).classList.remove(this.SUPER_TOKEN_STYLES.ACCORDION_CONTENT),e?.classList.remove(this.SUPER_TOKEN_STYLES.ACCORDION),t?.remove()}removePaymentMethodsListClasses(){const e=this.getCustomCheckoutEntireElement();e?.parentElement?.classList.remove(this.SUPER_TOKEN_STYLES.REMOVE_BOX_SHADOW),e?.classList.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST),e?.parentElement.classList.remove(this.SUPER_TOKEN_STYLES.REMOVE_BOX_SHADOW),e?.removeAttribute("role"),e?.removeAttribute("aria-label"),e?.removeAttribute("tabindex")}removePaymentMethodElements(){document.querySelectorAll(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD}`).forEach((e=>e.remove()))}closeAccordion(){const e=document.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR),t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION}`);e&&e.classList.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_ACCORDION_CONTENT_OPEN),t&&(t.style.height="48px")}deselectAllPaymentMethods(){document.querySelectorAll(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED}`).forEach((e=>{e.classList.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED),e.setAttribute("aria-selected","false")}))}selectNewCardAccordion(){const e=document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_ACCORDION}`),t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION_CONTENT}`),s=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION_HEADER}`);e&&t&&s?(e.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED),e.style.height="48px",s.setAttribute("aria-selected","true"),setTimeout((()=>{t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_ACCORDION_CONTENT_OPEN),requestAnimationFrame((()=>{e.style.height="auto",e.style.overflow="visible"}))}),10)):console.warn("Accordion elements not found")}selectPaymentMethod(e){e.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED),e.setAttribute("aria-selected","true")}setCheckoutType(e){document.querySelector(this.CHECKOUT_TYPE_SELECTOR).value=e}showPaymentMethodDetails(e){e.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_DETAILS}`)?.classList?.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HIDE)}hideAllPaymentMethodDetails(){document.querySelectorAll(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_DETAILS}`)?.forEach((e=>{e?.classList?.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HIDE)}))}fillCardTokenFields(e){document.getElementById("paymentMethodId").value=e.id,document.getElementById("paymentTypeId").value=e.type,document.getElementById("cardTokenId").value=e.token}paymentMethodAlreadySelected(e){return this.activePaymentMethod?.id===e.id}storeActivePaymentMethod(e){this.activePaymentMethod=e}onSelectSuperTokenPaymentMethod(e,t){this.paymentMethodAlreadySelected(t)||(this.storeActivePaymentMethod(t),this.hideAllPaymentMethodDetails(),this.closeAccordion(),this.deselectAllPaymentMethods(),this.selectPaymentMethod(e),this.fillCardTokenFields(t),this.setCheckoutType(this.SUPER_TOKEN_CHECKOUT_TYPE),this.showPaymentMethodDetails(e),this.mountSecurityCodeField(t),setTimeout((()=>{document.dispatchEvent(this.selectedSupertokenMethodEvent(!1))}),50))}onSelectNewCardPaymentMethod(){this.paymentMethodAlreadySelected({id:this.NEW_CARD_TYPE})||(this.removeClickableAreas(),this.storeActivePaymentMethod({id:this.NEW_CARD_TYPE}),this.deselectAllPaymentMethods(),this.hideAllPaymentMethodDetails(),this.unmountActiveSecurityCodeInstance(),this.selectNewCardAccordion(),this.setCheckoutType(this.CUSTOM_CHECKOUT_TYPE),setTimeout((()=>{this.mountCardForm()}),50),setTimeout((()=>{document.dispatchEvent(this.selectedSupertokenMethodEvent(!0))}),50))}selectedSupertokenMethodEvent=e=>new CustomEvent("supertoken_payment_method_selected",{detail:{new_card_selected:e}});isCreditCard(e){return e?.type===this.CREDIT_CARD_TYPE}isDebitCard(e){return e?.type===this.DEBIT_CARD_TYPE}isAccountMoney(e){return e?.type===this.ACCOUNT_MONEY_TYPE}isPrepaidCard(e){return e?.type===this.PREPAID_CARD_TYPE}isMercadoPagoCard(e){return e?.type===this.PREPAID_CARD_TYPE&&e?.issuer?.name?.toLowerCase()?.includes("mercado pago")}userHasAccountMoney(e){return e.has_account_money}userHasAccountMoneyInvested(e){return e.has_account_money_invested}buildAccountMoneyName(e){return this.getSiteId()!==this.MEXICO_ACCRONYM?this.ACCOUNT_MONEY_TEXT:this.userHasAccountMoney(e)?this.userHasAccountMoneyInvested(e)?this.ACCOUNT_MONEY_TEXT.concat(` + ${this.ACCOUNT_MONEY_INVESTED_TEXT}`):this.ACCOUNT_MONEY_TEXT:this.ACCOUNT_MONEY_INVESTED_TEXT}numberOfInstallmentsWithoutFee(e){if(!this.isCreditCard(e)||!e.installments?.length)return 0;const t=e.installments.filter((e=>0===e.installment_rate));return t[t.length-1].installments}buildPaymentMethodAriaLabel(e,t,s){return`${e.name}${t?` ${this.LAST_DIGITS_TEXT} ${t}`:""}${s?` ${this.INTEREST_FREE_PART_ONE_TEXT} ${s}${"MLB"===this.getSiteId()?"x":""} ${this.INTEREST_FREE_PART_TWO_TEXT}`:""}`}getSiteId(){return this.SITE_ID?.toUpperCase()}needsBankInterestDisclaimer(){return this.COUNTRIES_WITH_BANK_INTEREST_DISCLAIMER.includes(this.getSiteId())}formatCurrency(e){let t=new Intl.NumberFormat(this.INTL,{currency:this.CURRENCY,style:"currency",currencyDisplay:"narrowSymbol"}).format(e);return"MLM"===this.getSiteId()&&(t=t.replace(/^(\D+)/,"$1 ")),t}buildInstallmentTitle(e){const t=e.installments,s=this.formatCurrency(e.installment_amount),n=0!==e.installment_rate,r=this.formatCurrency(e.total_amount),o=this.needsBankInterestDisclaimer()?` + ${this.BANK_INTEREST_OPTION_TEXT}`:"";return 1===t?`${t}x ${r}`:n&&!o?`${t}x ${s} (${r})`:o?`${t}x ${s} (${r})${o}`:`${t}x ${s} ${this.INSTALLMENTS_INTEREST_FREE_OPTION_TEXT}`}getInstallmentsLimit(e){return this.getSiteId()===this.COLOMBIA_ACCRONYM?e.slice(0,Math.min(6,e.length)):e}normalizeInstallments(e){return this.getInstallmentsLimit(e).map((e=>{const t={value:`${e.installments}`,title:this.buildInstallmentTitle(e)};if("MLA"===this.getSiteId()&&e.labels){const s=this.parseTaxInfo(e.labels);s&&(t.taxInfo=s)}return t}))}parseTaxInfo(e){if(!e||!Array.isArray(e))return null;const t={cft:null,tna:null,tea:null},s=e=>{if(!e)return null;const t=e.replace("%","").trim();return/^\d+([,.]\d+)?$/.test(t)?t:null};return e.forEach((e=>{if("string"!=typeof e)return;e.split("|").forEach((e=>{if(e.includes("CFT_")){const n=e.split("CFT_");if(n.length>1&&n[1]){const e=s(n[1]);e&&(t.cft=e)}}else if(e.includes("TEA_")){const n=e.split("TEA_");if(n.length>1&&n[1]){const e=s(n[1]);e&&(t.tea=e)}}else if(e.includes("TNA_")){const n=e.split("TNA_");if(n.length>1&&n[1]){const e=s(n[1]);e&&(t.tna=e)}}}))})),t}getInstallmentsDropdownValue(e){return e.installments.find((t=>t.installments===e.installments)).installments}securityCodeIsRequired(e){return!!e&&"mandatory"===e?.mode}addDropdownEventListener(e){e?.addEventListener("mp-open-dropdown",(()=>{const e=document.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR);e&&(e.style.zIndex="9999 !important")})),e?.addEventListener("mp-close-dropdown",(()=>{const e=document.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR);e&&(e.style.zIndex="1")}))}buildSecurityCodeInnerHTML(e){if(!this.securityCodeIsRequired(e?.security_code_settings))return"";const t=3===e?.security_code_settings?.length?this.SECURITY_CODE_TOOLTIP_TEXT_3_DIGITS:this.SECURITY_CODE_TOOLTIP_TEXT_4_DIGITS;return`\n            <div\n                id="mp-super-token-security-code-container-${e.token}"\n                class="mp-super-token-security-code-container"\n            >\n                <label\n                    tabindex="0"\n                    class="mp-super-token-security-code-label"\n                >${this.SECURITY_CODE_INPUT_TITLE_TEXT}</label>\n                <div\n                    id="mp-super-token-security-code-input-${e.token}"\n                    class="mp-super-token-security-code-input"\n                ></div>\n                <span\n                    tabindex="0"\n                    aria-label="${t}"\n                    class="mp-super-token-security-code-tooltip"\n                    role="tooltip"\n                    data-tooltip="${t}"\n                >?</span>\n                <div\n                    id="mp-input-with-tooltip-helper-error"\n                    tabindex="0"\n                    class="mp-input-with-tooltip-helper-error"\n                >\n                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <rect width="12" height="12" rx="6" fill="#CC1818"/>\n                        <path d="M6.72725 2.90918H5.27271L5.45452 6.90918H6.54543L6.72725 2.90918Z" fill="white"/>\n                        <path d="M5.99998 7.63645C6.40164 7.63645 6.72725 7.96206 6.72725 8.36373C6.72725 8.76539 6.40164 9.091 5.99998 9.091C5.59832 9.091 5.27271 8.76539 5.27271 8.36373C5.27271 7.96206 5.59832 7.63645 5.99998 7.63645Z" fill="white"/>\n                    </svg>\n                    <span id="mp-super-token-security-code-error-message"></span>\n                </div>\n            </div>\n        `}buildCreditCardDetailsInnerHTML(e){if(!this.isCreditCard(e)&&!this.isDebitCard(e)&&!this.isPrepaidCard(e))return"";const t=document.createElement("section");if(t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_DETAILS),t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HIDE),this.isCreditCard(e)){const s=this.normalizeInstallments(e.installments);t.innerHTML=`\n                <andes-dropdown\n                    label="${this.INSTALLMENTS_INPUT_TITLE}"\n                    placeholder="${this.INSTALLMENTS_PLACEHOLDER}"\n                    required-message="${this.INSTALLMENTS_REQUIRED_MESSAGE}"\n                    items='${JSON.stringify(s)}'\n                    site-id="${this.getSiteId()}"\n                    ${this.needsBankInterestDisclaimer()?`hint="${this.INSTALLMENTS_HINT_TEXT}"`:""}\n                ></andes-dropdown>\n            `}return t.innerHTML+=this.buildSecurityCodeInnerHTML(e),t.outerHTML}mountCardForm(){window.mpCustomCheckoutHandler.cardForm.formMounted||window.mpCustomCheckoutHandler.cardForm.initCardForm(this.getAmount())}unmountCardForm(){window.mpCustomCheckoutHandler.cardForm.formMounted&&window.mpCustomCheckoutHandler.cardForm.form.unmount()}unmountActiveSecurityCodeInstance(){this.securityFieldsActiveInstance&&(this.securityFieldsActiveInstance.unmount(),this.securityFieldsActiveInstance=null)}storeActiveSecurityCodeInstance(e){this.securityFieldsActiveInstance=e}storeAmount(e){this.amount=e}getAmount(){return this.amount}async updateSecurityCode(){const e=this.activePaymentMethod;if(e&&this.securityCodeIsRequired(e?.security_code_settings))try{const{card_id:t}=await this.mpSdkInstance.getCardId(this.getSuperToken(),e.token),{id:s}=await this.mpSdkInstance.fields.createCardToken({cardId:t});await this.mpSdkInstance.updatePseudotoken(this.getSuperToken(),e.token,s)}catch(t){this.mpSuperTokenMetrics.errorToUpdateSecurityCode(t,e)}}toggleSecurityCodeErrorMessage(e,t){const s=document.getElementById(`mp-super-token-security-code-container-${t.token}`);if(!s)return;const n=s.querySelector("label"),r=s.querySelector("#mp-super-token-security-code-error-message"),o=s.querySelector("#mp-input-with-tooltip-helper-error"),i=s.querySelector(".mp-super-token-security-code-input");if(n.classList.remove("error"),s.classList.remove("error"),i.classList.remove("error"),o.style.display="none",r.innerHTML="",!e)return;n.classList.add("error"),s.classList.add("error"),i.classList.add("error");const a=this.SECURITY_CODE_ERROR_MESSAGES[e]??e;r.innerHTML=a,o.style.display="flex"}mountSecurityCodeField(e){if(!this.securityCodeIsRequired(e?.security_code_settings))return;this.unmountCardForm(),this.unmountActiveSecurityCodeInstance();const t=setInterval((()=>{if(document.getElementById(`mp-super-token-security-code-input-${e.token}`)){clearInterval(t);const s=3===e?.security_code_settings?.length?this.SECURITY_CODE_PLACEHOLDER_TEXT_3_DIGITS:this.SECURITY_CODE_PLACEHOLDER_TEXT_4_DIGITS,n=this.mpSdkInstance.fields.create("securityCode",{placeholder:s,ariaRequired:!0,style:{"font-size":"16px",height:"48px",padding:"14px"}}).mount(`mp-super-token-security-code-input-${e.token}`).on("error",(t=>this.mpSuperTokenMetrics.errorToMountCVVField(t,e))).on("ready",(()=>{n.update({settings:e?.security_code_settings}),this.storeActiveSecurityCodeInstance(n)})).on("validityChange",(t=>{0===t.errorMessages.length&&this.toggleSecurityCodeErrorMessage("",e);const s=t.errorMessages[0].cause;this.toggleSecurityCodeErrorMessage(s,e)}))}}),200)}createPaymentMethodElement(e){const t=e?.card?.card_number?.last_four_digits,s=document.createElement("article"),n=this.numberOfInstallmentsWithoutFee(e),r=this.buildPaymentMethodAriaLabel(e,t,n);if(s.id=e.token,s.dataset.type=e.type,s.dataset.id=e.id,s.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD),s.setAttribute("aria-label",r),s.setAttribute("tabindex","0"),s.setAttribute("role","option"),s.setAttribute("aria-selected","false"),s.innerHTML=`\n            <section class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HEADER}">\n                <section>\n                    <figure class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_THUMBNAIL}">\n                        <img src="${e.thumbnail}" alt="${e.name}">\n                    </figure>\n                    <article class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_CONTENT}">\n                        <span class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_TITLE}">${e.name}</span>\n                        ${this.isCreditCard(e)&&n>1?`<span\n                                aria-hidden="true"\n                                class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_VALUE_PROP}">\n                                ${this.INTEREST_FREE_PART_ONE_TEXT} ${n}${"MLB"===this.getSiteId()?"x":""} ${this.INTEREST_FREE_PART_TWO_TEXT}\n                            </span>`:""}\n                    </article>\n                    ${t?`\n                            <section class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LAST_FOUR_DIGITS}">\n                                <span>**** ${t}</span>\n                            </section>\n                        `:""}\n                </section>\n            </section>\n            ${this.buildCreditCardDetailsInnerHTML(e)}\n        `,s.addEventListener("click",this.onSelectSuperTokenPaymentMethod.bind(this,s,e)),s.addEventListener("keydown",(t=>{"Space"!=t.code&&"Enter"!=t.key||(t.preventDefault(),this.onSelectSuperTokenPaymentMethod.call(this,s,e))})),this.isCreditCard(e)){const e=s.querySelector("andes-dropdown");this.addDropdownEventListener(e),e?.addEventListener("change",(t=>{const s=t.detail;s&&(e.value=s.value,document.getElementById("cardInstallments").value=s.value)}))}return s}convertCreditCardFormToPaymentMethodElement(e){const t=e.querySelector(this.CHECKOUT_CONTAINER_SELECTOR);(e=>{e.classList.add(this.SUPER_TOKEN_STYLES.ACCORDION),e.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR).classList.add(this.SUPER_TOKEN_STYLES.ACCORDION_CONTENT)})(t);const s=(()=>{const e=document.createElement("section");return e.classList.add(this.SUPER_TOKEN_STYLES.ACCORDION_HEADER),e.setAttribute("aria-label",this.NEW_CARD_TEXT),e.setAttribute("tabindex","0"),e.setAttribute("role","option"),e.setAttribute("aria-selected","false"),e.innerHTML=`\n                <img src="${this.WHITE_CARD_PATH}">\n                <span class="${this.SUPER_TOKEN_STYLES.ACCORDION_TITLE}">${this.NEW_CARD_TEXT}</span>\n            `,e.addEventListener("click",this.onSelectNewCardPaymentMethod.bind(this)),e.addEventListener("keydown",(e=>{"Space"!=e.code&&"Enter"!=e.key||(e.preventDefault(),this.onSelectNewCardPaymentMethod.call(this))})),e})();return t.addEventListener("keyup",(e=>{"Tab"==e.key&&s.focus()})),t.appendChild(s),t}convertCustomCheckoutAreaToPaymentMethodList(e){e.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST),e.setAttribute("role","listbox"),e.setAttribute("aria-label",this.PAYMENT_METHODS_LIST_TEXT),e.setAttribute("tabindex","0"),e.parentElement.classList.add("mp-box-shadow-none")}reorderAccountPaymentMethods(e){const t=e.filter((e=>this.isCreditCard(e)||this.isDebitCard(e)||this.isPrepaidCard(e))),s=e.find((e=>this.isAccountMoney(e))),n=t.slice(0,3),r=(this.PAYMENT_METHODS_ORDER||this.PAYMENT_METHODS_ORDER_TYPE_CARDS_FIRST)===this.PAYMENT_METHODS_ORDER_TYPE_ACCOUNT_MONEY_FIRST&&s;return{beforeNewCardForm:r?[s]:n,afterNewCardForm:r?n:[s]}}normalizeAccountPaymentMethods(e){return e.map((e=>(this.isAccountMoney(e)&&(e.thumbnail=this.YELLOW_WALLET_PATH,e.name=this.buildAccountMoneyName(e)),this.isMercadoPagoCard(e)&&(e.name=this.MERCADO_PAGO_CARD_NAME),this.isPrepaidCard(e)&&(e.thumbnail=this.PAYMENT_METHODS_THUMBNAILS[e.id]||this.WHITE_CARD_PATH),(this.isCreditCard(e)||this.isDebitCard(e))&&(e.thumbnail=this.PAYMENT_METHODS_THUMBNAILS[e.id]||this.WHITE_CARD_PATH,e.name=(e.issuer.name??e.name)+" "+(this.isCreditCard(e)?"Crédito":"Débito")),e)))}onCustomCheckoutWasRendered(e,t){this.hideWalletButton(),this.convertCustomCheckoutAreaToPaymentMethodList(e),this.convertCreditCardFormToPaymentMethodElement(e);const s=this.reorderAccountPaymentMethods(t),n=s.beforeNewCardForm,r=s.afterNewCardForm,o=this.normalizeAccountPaymentMethods(n),i=this.normalizeAccountPaymentMethods(r);o.forEach((t=>{e.insertBefore(this.createPaymentMethodElement(t),e.firstChild)})),i.forEach((t=>{e.appendChild(this.createPaymentMethodElement(t))})),e.focus()}forceSecurityCodeValidation(e){const t=document.getElementById(`mp-super-token-security-code-container-${e.token}`);t&&(this.securityFieldsActiveInstance?(this.securityFieldsActiveInstance.focus(),setTimeout((()=>{this.securityFieldsActiveInstance.blur(),setTimeout((()=>{t.classList.contains("error")||this.toggleSecurityCodeErrorMessage("invalid_type",e)}),100)}),50)):this.toggleSecurityCodeErrorMessage("invalid_type",e))}forceShowValidationErrors(){if(window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),!this.activePaymentMethod)return;if(!this.isCreditCard(this.activePaymentMethod))return;const e=document.getElementById(this.activePaymentMethod.token);if(!e)return;const t=e.querySelector("andes-dropdown");t&&(t.state.hasInteracted=!0,t.validate()),this.securityCodeIsRequired(this.activePaymentMethod?.security_code_settings)&&this.forceSecurityCodeValidation(this.activePaymentMethod)}isSelectedPaymentMethodValid(){try{if(this.isAccountMoney(this.activePaymentMethod)||this.isDebitCard(this.activePaymentMethod)||this.isPrepaidCard(this.activePaymentMethod))return!0;if(this.activePaymentMethod.id===this.NEW_CARD_TYPE)return!0;const e=document.getElementById(this.activePaymentMethod.token);if(!e)return!1;const t=e.querySelector("andes-dropdown");if(!t)return!1;t.state.hasInteracted=!0;if(!t.validate())return!1;if(!this.securityCodeIsRequired(this.activePaymentMethod?.security_code_settings))return!0;if(!this.securityFieldsActiveInstance)return!1;const s=document.getElementById(`mp-super-token-security-code-container-${this.activePaymentMethod.token}`);if(!s)return!1;const n=s.classList.contains("error"),r=s.querySelector("#mp-input-with-tooltip-helper-error"),o=r&&"flex"===r.style.display;return!n&&!o}catch(e){return console.error("Error validating selected payment method after submit: ",e),!1}}renderAccountPaymentMethods(e,t){if(this.storeAmount(t),this.storeActivePaymentMethod(null),this.paymentMethodsAreRendered())return;this.hasStoredPaymentMethods()||this.storePaymentMethodsInMemory(e);const s=setInterval((()=>{const t=this.getCustomCheckoutEntireElement();t&&(clearInterval(s),this.onCustomCheckoutWasRendered(t,e))}),100);setTimeout((()=>{const e=this.mpSuperTokenMetrics.getSdkInstanceId();document.dispatchEvent(new CustomEvent("supertoken_loaded",{detail:{sdkInstanceId:e}}))}),500)}}