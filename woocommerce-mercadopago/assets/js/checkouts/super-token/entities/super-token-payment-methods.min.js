class MPSuperTokenPaymentMethods{SUPER_TOKEN_CHECKOUT_TYPE="super_token";CUSTOM_CHECKOUT_TYPE="custom";COUNTRIES_WITH_BANK_INTEREST_DISCLAIMER=["MCO","MPE","MLC"];CUSTOM_CHECKOUT_BLOCKS_SELECTOR="#radio-control-wc-payment-method-options-woo-mercado-pago-custom__content";CUSTOM_CHECKOUT_CLASSIC_SELECTOR=".payment_box.payment_method_woo-mercado-pago-custom";CARD_FLAGS_SELECTOR=".mp-checkout-custom-card-flags";CHECKOUT_CUSTOM_CONTAINER_SELECTOR=".mp-checkout-custom-container";CHECKOUT_CONTAINER_SELECTOR="#mp-checkout-custom-container.mp-checkout-container";CHECKOUT_TYPE_SELECTOR="#mp_checkout_type";COLOMBIA_ACCRONYM="MCO";MEXICO_ACCRONYM="MLM";BRAZIL_ACCRONYM="MLB";CHECKOUT_CUSTOM_LOAD_SELECTOR=".mp-checkout-custom-load";SELECTED_SUPERTOKEN_METHOD_EVENT="mp_super_token_payment_method_selected";WALLET_BUTTON_SELECTOR=".mp-wallet-button-container-wrapper";CARD_HOLDER_NAME_HELPER_INFO_SELECTOR="#mp-card-holder-name-helper-info";SUPER_TOKEN_STYLES={ACCORDION:"mp-super-token-payment-method__accordion",ACCORDION_HEADER:"mp-super-token-payment-method__accordion-header",ACCORDION_TITLE:"mp-super-token-payment-method__accordion-title",ACCORDION_CONTENT:"mp-super-token-payment-method__accordion-content",THUMBNAIL:"mp-super-token-payment-method__thumbnail",PAYMENT_METHOD_LIST:"mp-super-token-payment-methods-list",PAYMENT_METHOD:"mp-super-token-payment-method",PAYMENT_METHOD_CONTENT:"mp-super-token-payment-method__content",PAYMENT_METHOD_CONTENT_TITLE:"mp-super-token-payment-method__content-title",PAYMENT_METHOD_TITLE:"mp-super-token-payment-method__title",PAYMENT_METHOD_DESCRIPTION:"mp-super-token-payment-method__description",PAYMENT_METHOD_LAST_FOUR_DIGITS:"mp-super-token-payment-method__last-four-digits",PAYMENT_METHOD_SECURITY_CODE_FIELDS:"mp-super-token-payment-method__security-code-fields",PAYMENT_METHOD_SECURITY_CODE:"mp-super-token-payment-method__security-code",PAYMENT_METHOD_EXPIRATION_DATE:"mp-super-token-payment-method__expiration-date",PAYMENT_METHOD_SELECTED:"mp-super-token-payment-method__selected",PAYMENT_METHOD_ACCORDION:"mp-super-token-payment-method__accordion",PAYMENT_METHOD_THUMBNAIL:"mp-super-token-payment-method__thumbnail",PAYMENT_METHOD_ACCORDION_CONTENT_OPEN:"mp-super-token-payment-method__accordion-content--open",PAYMENT_METHOD_VALUE_PROP:"mp-super-token-payment-method__value-prop",PAYMENT_METHOD_DETAILS:"mp-super-token-payment-method__details",PAYMENT_METHOD_HEADER:"mp-super-token-payment-method__header",PAYMENT_METHOD_HIDE:"mp-super-token-hide",REMOVE_BOX_SHADOW:"mp-box-shadow-none",MERCADO_PAGO_PRIVACY_POLICY_FOOTER:"mp-privacy-policy-footer",PAYMENT_METHODS_LIST_HEADER:"mp-payment-methods-header",PAYMENT_METHODS_LIST_HORIZONTAL_ROW:"mp-payment-methods-list-horizontal-row",PAYMENT_METHODS_LIST_HEADER_LOGO:"mp-payment-methods-header-logo",ANIMATION_CLASS:"mp-initial-state"};YELLOW_WALLET_PATH=wc_mercadopago_supertoken_payment_methods_params.yellow_wallet_path;YELLOW_MONEY_PATH=wc_mercadopago_supertoken_payment_methods_params.yellow_money_path;WHITE_CARD_PATH=wc_mercadopago_supertoken_payment_methods_params.white_card_path;PAYMENT_METHODS_LIST_TEXT=wc_mercadopago_supertoken_payment_methods_params.payment_methods_list_text;PAYMENT_METHODS_LIST_ALT_TEXT=wc_mercadopago_supertoken_payment_methods_params.payment_methods_list_alt_text;LAST_DIGITS_TEXT=wc_mercadopago_supertoken_payment_methods_params.last_digits_text;NEW_CARD_TEXT=wc_mercadopago_supertoken_payment_methods_params.new_card_text;ACCOUNT_MONEY_TEXT=wc_mercadopago_supertoken_payment_methods_params.account_money_text;ACCOUNT_MONEY_WALLET_WITH_INVESTMENT_TEXT=wc_mercadopago_supertoken_payment_methods_params.account_money_wallet_with_investment_text;ACCOUNT_MONEY_WALLET_TEXT=wc_mercadopago_supertoken_payment_methods_params.account_money_wallet_text;ACCOUNT_MONEY_INVESTMENT_TEXT=wc_mercadopago_supertoken_payment_methods_params.account_money_investment_text;ACCOUNT_MONEY_AVAILABLE_TEXT=wc_mercadopago_supertoken_payment_methods_params.account_money_available_text;INTEREST_FREE_PART_ONE_TEXT=wc_mercadopago_supertoken_payment_methods_params.interest_free_part_one_text;INTEREST_FREE_PART_TWO_TEXT=wc_mercadopago_supertoken_payment_methods_params.interest_free_part_two_text;BANK_INTEREST_HINT_TEXT=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.bank_interest_hint_text;INSTALLMENTS_INPUT_TITLE=wc_mercadopago_supertoken_payment_methods_params.input_title.installments;INSTALLMENTS_PLACEHOLDER=wc_mercadopago_supertoken_payment_methods_params.placeholders.installments;INSTALLMENTS_REQUIRED_MESSAGE=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.required;INSTALLMENTS_INTEREST_FREE_OPTION_TEXT=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.installments.interest_free_option_text;SECURITY_CODE_INPUT_TITLE_TEXT=wc_mercadopago_supertoken_payment_methods_params.security_code_input_title_text;SECURITY_CODE_PLACEHOLDER_TEXT_3_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_placeholder_text_3_digits;SECURITY_CODE_PLACEHOLDER_TEXT_4_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_placeholder_text_4_digits;SECURITY_CODE_ERROR_MESSAGES=wc_mercadopago_supertoken_payment_methods_params.input_helper_message.securityCode;SECURITY_CODE_TOOLTIP_TEXT_3_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_tooltip_text_3_digits;SECURITY_CODE_TOOLTIP_TEXT_4_DIGITS=wc_mercadopago_supertoken_payment_methods_params.security_code_tooltip_text_4_digits;SITE_ID=wc_mercadopago_supertoken_payment_methods_params.site_id;CURRENCY=wc_mercadopago_supertoken_payment_methods_params.currency;INTL=wc_mercadopago_supertoken_payment_methods_params.intl;MERCADO_PAGO_CARD_NAME=wc_mercadopago_supertoken_payment_methods_params.mercado_pago_card_name;CONSUMER_CREDITS_DUE_DATE=wc_mercadopago_supertoken_payment_methods_params.consumer_credits_due_date;MLB_INSTALLMENT_DEBIT_AUTO_TEXT=wc_mercadopago_supertoken_payment_methods_params.mlb_installment_debit_auto_text;INTEREST_RATE_MLB_TEXT=wc_mercadopago_supertoken_payment_methods_params.interest_rate_mlb_text;EFFECTIVE_TOTAL_COST_MLB_TEXT=wc_mercadopago_supertoken_payment_methods_params.effective_total_cost_mlb_text;IOF_MLB_TEXT=wc_mercadopago_supertoken_payment_methods_params.iof_mlb_text;BORROWED_AMOUNT_MLB_TEXT=wc_mercadopago_supertoken_payment_methods_params.borrowed_amount_mlb_text;PER_MONTH=wc_mercadopago_supertoken_payment_methods_params.per_month;PER_YEAR=wc_mercadopago_supertoken_payment_methods_params.per_year;CAT_MLM_TEXT=wc_mercadopago_supertoken_payment_methods_params.cat_mlm_text;NO_IVA_TEXT=wc_mercadopago_supertoken_payment_methods_params.no_iva_text;TNA_MLM_TEXT=wc_mercadopago_supertoken_payment_methods_params.tna_mlm_text;SYSTEM_AMORTIZATION_MLM_TEXT=wc_mercadopago_supertoken_payment_methods_params.system_amortization_mlm_text;CFTEA_MLA_TEXT=wc_mercadopago_supertoken_payment_methods_params.cftea_mla_text;TNA_MLA_TEXT=wc_mercadopago_supertoken_payment_methods_params.tna_mla_text;TEA_MLA_TEXT=wc_mercadopago_supertoken_payment_methods_params.tea_mla_text;FIXED_RATE_TEXT=wc_mercadopago_supertoken_payment_methods_params.fixed_rate_text;MERCADO_PAGO_PRIVACY_POLICY=wc_mercadopago_supertoken_payment_methods_params.mercadopago_privacy_policy;NEW_MP_LOGO_PATH=wc_mercadopago_supertoken_payment_methods_params.new_mp_logo_path;PAYMENT_METHODS_THUMBNAILS=wc_mercadopago_supertoken_payment_methods_params.payment_methods_thumbnails;PAYMENT_METHODS_ORDER=wc_mercadopago_supertoken_payment_methods_params.payment_methods_order;UPDATE_SECURITY_CODE_WITH_RETRY_ERROR_TEXT=wc_mercadopago_supertoken_payment_methods_params.update_security_code_with_retry_error_text;UPDATE_SECURITY_CODE_NO_RETRY_ERROR_TEXT=wc_mercadopago_supertoken_payment_methods_params.update_security_code_no_retry_error_text;AUTHORIZE_PAYMENT_METHOD_WITH_RETRY_ERROR_TEXT=wc_mercadopago_supertoken_payment_methods_params.authorize_payment_method_with_retry_error_text;AUTHORIZE_PAYMENT_METHOD_NO_RETRY_ERROR_TEXT=wc_mercadopago_supertoken_payment_methods_params.authorize_payment_method_no_retry_error_text;SELECT_PAYMENT_METHOD_ERROR_TEXT=wc_mercadopago_supertoken_payment_methods_params.select_payment_method_error_text;SUBMIT_SUPER_TOKEN_GENERIC_ERROR_TEXT=wc_mercadopago_supertoken_payment_methods_params.update_security_code_with_retry_error_text;NEW_CARD_TYPE="new_card";CREDIT_CARD_TYPE="credit_card";DEBIT_CARD_TYPE="debit_card";ACCOUNT_MONEY_TYPE="account_money";PREPAID_CARD_TYPE="prepaid_card";CONSUMER_CREDITS_TYPE="digital_currency";PAYMENT_METHODS_ORDER_TYPE_CARDS_FIRST="cards_first";PAYMENT_METHODS_ORDER_TYPE_ACCOUNT_MONEY_FIRST="account_money_first";MAX_ATTEMPTS_BY_ERROR_CODE=3;paymentMethods=[];superToken=null;securityFieldsActiveInstance=null;activePaymentMethod=null;amount=null;selectedPreloadedPaymentMethod=null;securityCodeReferences={};lastPaymentMethodChoosen=null;attemptsByErrorCode={};mpSdkInstance=null;mpSuperTokenMetrics=null;constructor(e,t){this.mpSdkInstance=e,this.mpSuperTokenMetrics=t}reset(){this.paymentMethods=[],this.attemptsByErrorCode={},this.securityCodeReferences={},this.activePaymentMethod=null,this.unmountActiveSecurityCodeInstance(),this.hideAllPaymentMethodDetails(),this.showWalletButton(),this.showCardFlags(),this.removePaymentMethodElements(),this.removePaymentMethodsListHeader(),this.removeAccordion(),this.deselectAllPaymentMethods(),this.removePaymentMethodsListClasses(),this.removeMercadoPagoPrivacyPolicyFooter(),this.removeHorizontalRow()}storePaymentMethodsInMemory(e){this.paymentMethods=e}getStoredPaymentMethods(){return this.paymentMethods}hasStoredPaymentMethods(){return this.paymentMethods.length>0}storeSelectedPreloadedPaymentMethod(e){this.selectedPreloadedPaymentMethod=e}getSelectedPreloadedPaymentMethod(){return this.selectedPreloadedPaymentMethod}getSelectedPreloadedPaymentMethodFromActivePaymentMethods(){return this.paymentMethods.find((e=>this.paymentMethodIdentifier(e)===this.paymentMethodIdentifier(this.selectedPreloadedPaymentMethod)))}paymentMethodIdentifier(e){return e?`${e?.id}${e?.card?.card_number?.last_four_digits||""}`:""}setSuperToken(e){this.superToken=e}getSuperToken(){return this.superToken}paymentMethodsAreRendered(){return!!document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD}`)}async getAccountPaymentMethods(e){return this.setSuperToken(e),await this.mpSdkInstance.getAccountPaymentMethods(e)}getAttemptByErrorCode(e){return Math.min(this.attemptsByErrorCode[e]||0,this.MAX_ATTEMPTS_BY_ERROR_CODE)}shouldAllowRetry(e){return e<this.MAX_ATTEMPTS_BY_ERROR_CODE}storeAttemptByErrorCode(e){this.attemptsByErrorCode[e]=(this.attemptsByErrorCode[e]||0)+1}convertErrorCodeToErrorMessage(e){this.storeAttemptByErrorCode(e);const t={UPDATE_SECURITY_CODE_ERROR:{withRetry:this.UPDATE_SECURITY_CODE_WITH_RETRY_ERROR_TEXT,withoutRetry:this.UPDATE_SECURITY_CODE_NO_RETRY_ERROR_TEXT},AUTHORIZE_PAYMENT_METHOD_ERROR:{withRetry:this.AUTHORIZE_PAYMENT_METHOD_WITH_RETRY_ERROR_TEXT,withoutRetry:this.AUTHORIZE_PAYMENT_METHOD_NO_RETRY_ERROR_TEXT},AUTHORIZE_PAYMENT_METHOD_USER_CANCELLED:{withRetry:this.AUTHORIZE_PAYMENT_METHOD_WITH_RETRY_ERROR_TEXT,withoutRetry:this.AUTHORIZE_PAYMENT_METHOD_NO_RETRY_ERROR_TEXT},SELECT_PAYMENT_METHOD_ERROR:{withRetry:this.SELECT_PAYMENT_METHOD_ERROR_TEXT,withoutRetry:this.SELECT_PAYMENT_METHOD_ERROR_TEXT}},s=Object.entries(t).find((([t])=>e.includes(t)))?.[1]||null;return s?this.shouldAllowRetry(this.getAttemptByErrorCode(e))?s.withRetry:s.withoutRetry:this.SUBMIT_SUPER_TOKEN_GENERIC_ERROR_TEXT}showSuperTokenError(e){const t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST}`);if(!t)return;const s=document.createElement("andes-notice");s.id="mp-fast-payments-error",s.setAttribute("type","warning"),s.setAttribute("description",e),t.insertBefore(s,t.firstChild),s.scrollIntoView({behavior:"smooth"})}hideSuperTokenError(){const e=document.getElementById("mp-fast-payments-error");e&&e.remove()}getCustomCheckoutEntireElement(){return document.querySelector(this.CUSTOM_CHECKOUT_BLOCKS_SELECTOR)||document.querySelector(this.CUSTOM_CHECKOUT_CLASSIC_SELECTOR)}getWalletButtonElement(){return document.querySelector(this.WALLET_BUTTON_SELECTOR)}getCardFlagsElement(){return document.querySelector(this.CARD_FLAGS_SELECTOR)}hideWalletButton(){const e=this.getWalletButtonElement();e&&(e.style.display="none")}showWalletButton(){const e=this.getWalletButtonElement();e&&(e.style.display="flex")}hideCardFlags(){const e=this.getCardFlagsElement();e&&(e.style.display="none")}showCardFlags(){const e=this.getCardFlagsElement();e&&(e.style.display="flex")}removeAccordion(){const e=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION}`),t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION_HEADER}`);e?.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR).classList.remove(this.SUPER_TOKEN_STYLES.ACCORDION_CONTENT),e?.classList.remove(this.SUPER_TOKEN_STYLES.ACCORDION),t?.remove()}removePaymentMethodsListClasses(){const e=this.getCustomCheckoutEntireElement(),t=e?.querySelector(this.CHECKOUT_CONTAINER_SELECTOR);t&&(t.style.height="auto"),e?.parentElement?.classList.remove(this.SUPER_TOKEN_STYLES.REMOVE_BOX_SHADOW),e?.classList.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST),e?.parentElement.classList.remove(this.SUPER_TOKEN_STYLES.REMOVE_BOX_SHADOW),e?.removeAttribute("role"),e?.removeAttribute("aria-label"),e?.removeAttribute("tabindex")}removePaymentMethodElements(){document.querySelectorAll(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD}`).forEach((e=>e.remove()))}closeAccordion(){const e=document.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR),t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION}`);e&&e.classList.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_ACCORDION_CONTENT_OPEN),t&&(t.style.height="48px")}deselectAllPaymentMethods(){document.querySelectorAll(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED}`).forEach((e=>{e.classList.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED),e.setAttribute("aria-selected","false")}))}selectNewCardAccordion(){const e=document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_ACCORDION}`),t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION_CONTENT}`),s=document.querySelector(`.${this.SUPER_TOKEN_STYLES.ACCORDION_HEADER}`);e&&t&&s?(e.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED),e.style.height="48px",s.setAttribute("aria-selected","true"),setTimeout((()=>{t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_ACCORDION_CONTENT_OPEN),requestAnimationFrame((()=>{e.style.height="auto",e.style.overflow="visible"}))}),10)):console.warn("Accordion elements not found")}selectPaymentMethod(e){e.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED),e.setAttribute("aria-selected","true")}getPaymentMethodSelectedFromDOMToAccountPaymentMethods(e){const t=document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED}`)||null;return t?e.find((e=>this.paymentMethodIdentifier(e)===t.id)):null}getPaymentMethodElementFromDOM(e){return document.getElementById(this.paymentMethodIdentifier(e))}selectPreloadedPaymentMethod(){this.closeAccordion();const e=this.getSelectedPreloadedPaymentMethodFromActivePaymentMethods();if(!e)return;const t=document.getElementById(this.paymentMethodIdentifier(e));t&&this.onSelectSuperTokenPaymentMethod(t,e)}setCheckoutType(e){document.querySelector(this.CHECKOUT_TYPE_SELECTOR).value=e}setPaymentMethodChildrenAriaVisible(e){const t=e.querySelector(".mp-super-token-security-code-container");if(t){const e=t.querySelector(".mp-super-token-security-code-label"),s=t.querySelector(".mp-super-token-security-code-input"),n=t.querySelector(".mp-super-token-security-code-tooltip");e?.setAttribute("aria-hidden","false"),e?.setAttribute("tabindex","0"),s?.setAttribute("aria-hidden","false"),s?.setAttribute("tabindex","0"),n?.setAttribute("aria-hidden","false"),n?.setAttribute("tabindex","0")}const s=e.querySelector(`#mp-super-token-installments-select-${this.paymentMethodIdentifier(e)}`);s&&(s.setAttribute("aria-hidden","false"),s.setAttribute("tabindex","0"))}setPaymentMethodChildrenAriaHidden(e){const t=e.querySelector(".mp-super-token-security-code-container");if(t){const e=t.querySelector(".mp-super-token-security-code-label"),s=t.querySelector(".mp-super-token-security-code-input"),n=t.querySelector(".mp-super-token-security-code-tooltip");e?.setAttribute("aria-hidden","true"),e?.setAttribute("tabindex","-1"),s?.setAttribute("aria-hidden","true"),s?.setAttribute("tabindex","-1"),n?.setAttribute("aria-hidden","true"),n?.setAttribute("tabindex","-1")}const s=e.querySelector(`#mp-super-token-installments-select-${this.paymentMethodIdentifier(e)}`);s&&(s.setAttribute("aria-hidden","true"),s.setAttribute("tabindex","-1"))}showPaymentMethodDetails(e){e.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_DETAILS}`)?.classList?.remove(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HIDE),this.setPaymentMethodChildrenAriaVisible(e)}hideAllPaymentMethodDetails(){document.querySelectorAll(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_DETAILS}`)?.forEach((e=>{e?.classList?.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HIDE),this.setPaymentMethodChildrenAriaHidden(e)}))}fillCardTokenFields(e){document.getElementById("paymentMethodId").value=e.id,document.getElementById("paymentTypeId").value=e.type,document.getElementById("cardTokenId").value=e.token}paymentMethodAlreadySelected(e){const t=this.getPaymentMethodElementFromDOM(e);return!!t&&t.classList.contains(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_SELECTED)}getActivePaymentMethod(){return this.activePaymentMethod}storeActivePaymentMethod(e){this.activePaymentMethod=e,this.lastPaymentMethodChoosen=e||this.lastPaymentMethodChoosen}getLastPaymentMethodChoosen(){return this.lastPaymentMethodChoosen}selectLastPaymentMethodChoosen(){this.closeAccordion();const e=this.getLastPaymentMethodChoosen();if(!e)return;const t=document.getElementById(this.paymentMethodIdentifier(e));t&&this.onSelectSuperTokenPaymentMethod(t,e)}hasCheckoutError(){return!!document.querySelector("#mp-fast-payments-error")}formatSelectedPaymentMethodName(e){if(this.paymentMethodIdentifier(e)===this.paymentMethodIdentifier({id:this.NEW_CARD_TYPE}))return"new_credit_card";if(e?.type===this.ACCOUNT_MONEY_TYPE)return this.ACCOUNT_MONEY_TYPE;const t=`${e?.id||"none"} ${e?.type||"none"}`.toLowerCase(),s=e?.card?.card_number?.last_four_digits;return t.concat(s?` ${s}`:"")}emitEventFromSelectPaymentMethod(e){const t=this.formatSelectedPaymentMethodName(e);document.dispatchEvent(new CustomEvent(this.SELECTED_SUPERTOKEN_METHOD_EVENT,{detail:{payment_method:t}}))}onSelectSuperTokenPaymentMethod(e,t){this.paymentMethodAlreadySelected(t)||(this.emitEventFromSelectPaymentMethod(t),this.storeActivePaymentMethod(t),this.hideAllPaymentMethodDetails(),this.closeAccordion(),this.deselectAllPaymentMethods(),this.selectPaymentMethod(e),this.fillCardTokenFields(t),this.setCheckoutType(this.SUPER_TOKEN_CHECKOUT_TYPE),this.showPaymentMethodDetails(e),this.mountSecurityCodeField(t),this.handleInstallmentsWithoutFeePillVisibility(t),setTimeout((()=>{document.dispatchEvent(this.selectedSupertokenMethodEvent(!1))}),50))}onSelectNewCardPaymentMethod(){this.paymentMethodAlreadySelected({id:this.NEW_CARD_TYPE})||(this.emitEventFromSelectPaymentMethod({id:this.NEW_CARD_TYPE}),this.storeActivePaymentMethod({id:this.NEW_CARD_TYPE}),this.deselectAllPaymentMethods(),this.hideAllPaymentMethodDetails(),this.unmountActiveSecurityCodeInstance(),this.selectNewCardAccordion(),this.setCheckoutType(this.CUSTOM_CHECKOUT_TYPE),this.handleInstallmentsWithoutFeePillVisibility({type:"credit_card"}),setTimeout((()=>{this.unmountCardForm(),this.mountCardForm(),this.showCardHolderNameHelperInfo()}),50),setTimeout((()=>{document.dispatchEvent(this.selectedSupertokenMethodEvent(!0))}),50))}selectedSupertokenMethodEvent=e=>new CustomEvent("supertoken_payment_method_selected",{detail:{new_card_selected:e,checkout_type:document.querySelector("#mp_checkout_type")?.value}});isCreditCard(e){return e?.type===this.CREDIT_CARD_TYPE}isDebitCard(e){return e?.type===this.DEBIT_CARD_TYPE}isAccountMoney(e){return e?.type===this.ACCOUNT_MONEY_TYPE}isPrepaidCard(e){return e?.type===this.PREPAID_CARD_TYPE}isMercadoPagoCard(e){return e?.type===this.PREPAID_CARD_TYPE&&e?.issuer?.name?.toLowerCase()?.includes("mercado pago")}isConsumerCredits(e){return e?.type===this.CONSUMER_CREDITS_TYPE}userHasAccountMoney(e){return e.has_account_money}userHasAccountMoneyInvested(e){return e.has_account_money_invested}buildAccountMoneyName(e){return this.getSiteId()!==this.MEXICO_ACCRONYM?this.ACCOUNT_MONEY_TEXT:this.userHasAccountMoney(e)&&this.userHasAccountMoneyInvested(e)?this.ACCOUNT_MONEY_WALLET_WITH_INVESTMENT_TEXT:this.userHasAccountMoney(e)?this.ACCOUNT_MONEY_WALLET_TEXT:this.userHasAccountMoneyInvested(e)?this.ACCOUNT_MONEY_INVESTMENT_TEXT:this.ACCOUNT_MONEY_AVAILABLE_TEXT}buildConsumerCreditsName(){switch(this.getSiteId()){case this.MEXICO_ACCRONYM:return"Meses sin Tarjeta con Mercado&nbsp;Pago";case this.BRAZIL_ACCRONYM:return"Linha de Crédito Mercado&nbsp;Pago";default:return"Cuotas sin Tarjeta con Mercado&nbsp;Pago"}}numberOfInstallmentsWithoutFee(e){if(!this.isCreditCard(e)&&!this.isConsumerCredits(e))return 0;if(!e.installments||!e.installments.length)return 0;if(this.isConsumerCredits(e)){const t=e.installments.filter((e=>0===e.installment_rate));return t.length>0?t[t.length-1].installments:0}const t=e.installments.filter((e=>0===e.installment_rate&&e.installment_rate_collector.includes("MERCADOPAGO")));return t[t.length-1].installments}buildPaymentMethodAriaLabel(e,t,s){const n=e?.name;return`${n}${t?` ${this.LAST_DIGITS_TEXT} ${t}`:""}${s?` ${this.INTEREST_FREE_PART_ONE_TEXT} ${s}${"MLB"===this.getSiteId()?"x":""} ${this.INTEREST_FREE_PART_TWO_TEXT}`:""}`}getSiteId(){return this.SITE_ID?.toUpperCase()}needsBankInterestDisclaimer(){return this.COUNTRIES_WITH_BANK_INTEREST_DISCLAIMER.includes(this.getSiteId())}formatDateToDayAndMonth(e){if(!e)return"";const t=e.split("-");if(3!==t.length)return e;const[s,n,o]=t,r={"01":"jan","02":"feb","03":"mar","04":"apr","05":"may","06":"jun","07":"jul","08":"aug","09":"sep",10:"oct",11:"nov",12:"dec"}[n],i=wc_mercadopago_supertoken_payment_methods_params.months_abbreviated&&wc_mercadopago_supertoken_payment_methods_params.months_abbreviated[r]?wc_mercadopago_supertoken_payment_methods_params.months_abbreviated[r]:n;return`${parseInt(o)}/${i}`}formatCurrency(e){let t=new Intl.NumberFormat(this.INTL,{currency:this.CURRENCY,style:"currency",currencyDisplay:"narrowSymbol"}).format(e);return"MLM"===this.getSiteId()&&(t=t.replace(/^(\D+)/,"$1 ")),t}buildInstallmentTitle(e){const t=e.installments,s=this.formatCurrency(e.installment_amount),n=0!==e.installment_rate,o=e.installment_rate_collector.includes("THIRD_PARTY"),r=this.formatCurrency(e.total_amount);return 1===t?`${t}x ${r}`:n?`${t}x ${s} (${r})`:this.needsBankInterestDisclaimer()&&o&&!n?`${t}x ${s} (${r})*`:`${t}x ${s} ${this.INSTALLMENTS_INTEREST_FREE_OPTION_TEXT}`}getInstallmentsLimit(e){return this.getSiteId()===this.COLOMBIA_ACCRONYM?e.slice(0,Math.min(6,e.length)):e}normalizeInstallments(e){return this.getInstallmentsLimit(e)?.map((e=>{const t={value:`${e.installments}`,title:this.buildInstallmentTitle(e)};if("MLA"===this.getSiteId()&&e.labels){const s=this.parseTaxInfo(e.labels);s&&(t.taxInfo=s)}return t}))}parseTaxInfo(e){if(!e||!Array.isArray(e))return null;const t={cft:null,tna:null,tea:null},s=e=>{if(!e)return null;const t=e.replace("%","").trim();return/^\d+([,.]\d+)?$/.test(t)?t:null};return e.forEach((e=>{if("string"!=typeof e)return;e.split("|").forEach((e=>{if(e.includes("CFT_")){const n=e.split("CFT_");if(n.length>1&&n[1]){const e=s(n[1]);e&&(t.cft=e)}}else if(e.includes("TEA_")){const n=e.split("TEA_");if(n.length>1&&n[1]){const e=s(n[1]);e&&(t.tea=e)}}else if(e.includes("TNA_")){const n=e.split("TNA_");if(n.length>1&&n[1]){const e=s(n[1]);e&&(t.tna=e)}}}))})),t}getInstallmentsDropdownValue(e){return e.installments.find((t=>t.installments===e.installments)).installments}securityCodeIsRequired(e){return!!e&&"mandatory"===e?.mode}addDropdownEventListener(e){e?.addEventListener("mp-open-dropdown",(()=>{const e=document.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR);e&&(e.style.zIndex="9999 !important")})),e?.addEventListener("mp-close-dropdown",(()=>{const e=document.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR);e&&(e.style.zIndex="1")}))}buildSecurityCodeInnerHTML(e){if(!this.securityCodeIsRequired(e?.security_code_settings))return"";const t=3===e?.security_code_settings?.length?this.SECURITY_CODE_TOOLTIP_TEXT_3_DIGITS:this.SECURITY_CODE_TOOLTIP_TEXT_4_DIGITS;return`\n            <div\n                id="mp-super-token-security-code-container-${e.token}"\n                class="mp-super-token-security-code-container"\n            >\n                <label\n                    tabindex="0"\n                    class="mp-super-token-security-code-label"\n                >${this.SECURITY_CODE_INPUT_TITLE_TEXT}</label>\n                <div\n                    id="mp-super-token-security-code-input-${e.token}"\n                    class="mp-super-token-security-code-input"\n                ></div>\n                <span\n                    tabindex="0"\n                    aria-label="${t}"\n                    class="mp-super-token-security-code-tooltip"\n                    role="tooltip"\n                    data-tooltip="${t}"\n                    style="display: none !important;"\n                >?</span>\n                <div\n                    id="mp-input-with-tooltip-helper-error"\n                    tabindex="0"\n                    class="mp-input-with-tooltip-helper-error"\n                    role="alert"\n                >\n                    <svg aria-hidden="true" tabindex="-1" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <rect width="12" height="12" rx="6" fill="#CC1818"/>\n                        <path d="M6.72725 2.90918H5.27271L5.45452 6.90918H6.54543L6.72725 2.90918Z" fill="white"/>\n                        <path d="M5.99998 7.63645C6.40164 7.63645 6.72725 7.96206 6.72725 8.36373C6.72725 8.76539 6.40164 9.091 5.99998 9.091C5.59832 9.091 5.27271 8.76539 5.27271 8.36373C5.27271 7.96206 5.59832 7.63645 5.99998 7.63645Z" fill="white"/>\n                    </svg>\n                    <span\n                      id="mp-super-token-security-code-error-message"\n                      class="mp-super-token-security-code-error-message"\n                      aria-hidden="true"\n                      tabindex="-1"\n                    ></span>\n                </div>\n            </div>\n        `}buildConsumerCreditsHint(e){const t=(e?.labels.find((e=>e.toLowerCase().includes("|")))?.toLowerCase()??"").split("|").reduce(((e,t)=>{const[s,n]=t.split("_");return e[s]=n,e}),{});if(!e?.consumer_credits?.conditions)return"";switch(this.getSiteId()){case this.BRAZIL_ACCRONYM:const s=[];if(t.tem&&t.tea&&s.push(`${this.INTEREST_RATE_MLB_TEXT}: ${t.tem} ${this.PER_MONTH} ${t.tea} ${this.PER_YEAR}`),t.cetm&&t.ceta&&s.push(`${this.EFFECTIVE_TOTAL_COST_MLB_TEXT}: ${t.cetm} ${this.PER_MONTH} ${t.ceta} ${this.PER_YEAR}`),t.iof){const n=e.installment_iof_amount||0;if(n>0){const e=n.toFixed(2).replace(".",",");s.push(`${this.IOF_MLB_TEXT}: R$ ${e} (${t.iof})`)}}const n=e.total_amount-(e.installment_iof_amount||0);return s.push(`${this.BORROWED_AMOUNT_MLB_TEXT}: R$ ${n.toFixed(2).replace(".",",")}`),s.join(". ")+".";case this.MEXICO_ACCRONYM:const o=[];return t.cat&&o.push(`${this.CAT_MLM_TEXT}: ${t.cat} ${this.NO_IVA_TEXT}`),t.tna&&o.push(`${this.TNA_MLM_TEXT}: ${t.tna}`),o.length>0?(o.push(`${this.SYSTEM_AMORTIZATION_MLM_TEXT}`),`${o.join(". ")}.`):"";default:const r=[];return t.cftea&&r.push(`<strong>${this.CFTEA_MLA_TEXT}: ${t.cftea}</strong>`),t.tna&&r.push(`${this.TNA_MLA_TEXT}: ${t.tna}`),t.tea&&r.push(`${this.TEA_MLA_TEXT}: ${t.tea}`),r.length>0?`${r.join(" - ")}. ${this.FIXED_RATE_TEXT}`:""}}buildConsumerCreditsDetailsInnerHTML(e){if(!this.isConsumerCredits(e))return"";const t=document.createElement("section");t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_DETAILS),t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HIDE);const s=e?.installments?.map((e=>({value:`${e.installments}`,title:this.buildInstallmentTitle(e)})));return t.innerHTML=`\n            <andes-dropdown\n                label="${this.INSTALLMENTS_INPUT_TITLE}"\n                placeholder="${this.INSTALLMENTS_PLACEHOLDER}"\n                required-message="${this.INSTALLMENTS_REQUIRED_MESSAGE}"\n                items='${JSON.stringify(s||[])}'\n                site-id="${this.getSiteId()}"\n            ></andes-dropdown>\n\n            <div class="mp-consumer-credits-due-date" id="mp-consumer-credits-due-date" style="display: none;">\n            </div>\n\n            <div class="mp-consumer-credits-debit-auto-text" id="mp-consumer-credits-debit-auto-text" style="display: none; text-align: center;"></div>\n\n            <div id="mp-consumer-credits-legal-text" style="display: none;"></div>\n        `,t.outerHTML}buildConsumerCreditsDetailsDueDate(e){if(!this.isConsumerCredits(e))return"";const t=document.getElementById("mp-consumer-credits-due-date");return t?(t.innerHTML=`\n            <span style="font-weight: 400 !important;">${this.CONSUMER_CREDITS_DUE_DATE}\n            <b style="font-weight: 600 !important;">${this.formatDateToDayAndMonth(e.next_due_date)}</b>.\n            </span>\n        `,t.outerHTML):void 0}buildCreditCardDetailsInnerHTML(e){if(!this.isCreditCard(e)&&!this.isDebitCard(e)&&!this.isPrepaidCard(e))return"";const t=document.createElement("section");if(t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_DETAILS),t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HIDE),this.isCreditCard(e)&&e.installments?.length){const s=[{value:"",title:this.INSTALLMENTS_PLACEHOLDER,disabled:!0,selected:!0},...this.normalizeInstallments(e.installments)];t.innerHTML=`\n              <div class="mp-checkout-custom-installments-select-container">\n                <label for="mp-super-token-installments-select-${this.paymentMethodIdentifier(e)}" class="mp-input-label">\n                  ${this.INSTALLMENTS_INPUT_TITLE}\n                </label>\n                <select\n                  data-checkout="installments"\n                  name="installments"\n                  id="mp-super-token-installments-select-${this.paymentMethodIdentifier(e)}"\n                  class="mp-custom-checkout-select-input"\n                >\n                  ${s.map((e=>`<option ${e.disabled?"disabled":""} ${e.selected?"selected":""} value="${e.value}">${e.title}</option>`)).join("")}\n                </select>\n                <input-helper\n                  isVisible=false\n                  type="error"\n                  message="${this.INSTALLMENTS_REQUIRED_MESSAGE}"\n                  input-id="mp-super-token-installments-error-${this.paymentMethodIdentifier(e)}"\n                >\n                </input-helper>\n                <div id="mp-super-token-installments-tax-info-${this.paymentMethodIdentifier(e)}" class="mp-installments-tax-info" style="display: none;"></div>\n              </div>\n            `}return t.innerHTML+=this.buildSecurityCodeInnerHTML(e),t.outerHTML}installmentsWasSelected(e){const t=document.getElementById(`mp-super-token-installments-select-${this.paymentMethodIdentifier(e)}`);return!!t?.value}setInstallmentsErrorState(e,t){const s=this.paymentMethodIdentifier(e),n=document.getElementById(`mp-super-token-installments-select-${s}`),o=document.querySelector(`label[for="mp-super-token-installments-select-${s}"]`),r=document.querySelector(`#mp-super-token-installments-error-${s}`);n&&o&&r&&(t?(r.style.display="flex",n.classList.add("mp-super-token-error"),o.classList.add("mp-super-token-label-error")):(r.style.display="none",n.classList.remove("mp-super-token-error"),o.classList.remove("mp-super-token-label-error")))}buildMLBConsumerCreditsLegalText(){const e=document.getElementById("mp-consumer-credits-debit-auto-text");e&&(e.innerHTML=`\n            <span>\n                ${this.MLB_INSTALLMENT_DEBIT_AUTO_TEXT}\n            </span>\n        `)}mountCardForm(){window.mpCustomCheckoutHandler.cardForm.formMounted||window.mpCustomCheckoutHandler.cardForm.initCardForm(this.getAmount())}unmountCardForm(){window.mpCustomCheckoutHandler.cardForm.formMounted&&window.mpCustomCheckoutHandler.cardForm.form.unmount()}unmountActiveSecurityCodeInstance(){this.securityFieldsActiveInstance&&(this.securityFieldsActiveInstance.unmount(),this.securityFieldsActiveInstance=null)}storeActiveSecurityCodeInstance(e){this.securityFieldsActiveInstance=e}storeAmount(e){this.amount=e}getAmount(){return this.amount}getCheckoutLoaderElement(){return document.querySelector(".mp-checkout-custom-load")}moveCheckoutLoaderToPaymentMethodsList(){const e=this.getCheckoutLoaderElement(),t=document.querySelector(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST);e&&t&&t.parentElement.appendChild(e)}removeCheckoutLoaderFromPaymentMethodsList(){const e=this.getCheckoutLoaderElement(),t=this.getCustomCheckoutEntireElement();e&&t&&t.appendChild(e)}getPaymentMethodsListElement(){return document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST}`)}hidePaymentMethodsList(){const e=document.querySelector(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST);e&&(e.style.display="none")}showPaymentMethodsList(){const e=document.querySelector(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST);e&&(e.style.display="flex")}async updateSecurityCode(){const e=this.activePaymentMethod;if(e&&this.securityCodeIsRequired(e?.security_code_settings))try{const{card_id:t}=await this.mpSdkInstance.getCardId(this.getSuperToken(),e.token),{id:s}=await this.mpSdkInstance.fields.createCardToken({cardId:t});await this.mpSdkInstance.updatePseudotoken(this.getSuperToken(),e.token,s)}catch(t){throw this.mpSuperTokenMetrics.errorToUpdateSecurityCode(t,e),new Error(MPSuperTokenErrorCodes.UPDATE_SECURITY_CODE_ERROR)}}toggleSecurityCodeErrorMessage(e,t){const s=document.getElementById(`mp-super-token-security-code-container-${t.token}`);if(!s)return;const n=s.querySelector("label"),o=s.querySelector("#mp-super-token-security-code-error-message"),r=s.querySelector("#mp-input-with-tooltip-helper-error"),i=s.querySelector(".mp-super-token-security-code-input");if(n.classList.remove("error"),s.classList.remove("error"),i.classList.remove("error"),r.style.display="none",o.innerHTML="",!e)return;n.classList.add("error"),s.classList.add("error"),i.classList.add("error");const a=this.SECURITY_CODE_ERROR_MESSAGES[e]??e;o.innerHTML=a,r.setAttribute("aria-label",a),r.style.display="flex"}verifyIsSecurityCodeReferenceTrue(e){return!0===this.securityCodeReferences[this.paymentMethodIdentifier(e)]}setSecurityCodeReferenceFalse(e){this.securityCodeReferences[this.paymentMethodIdentifier(e)]=!1}setSecurityCodeReferenceTrue(e){this.securityCodeReferences[this.paymentMethodIdentifier(e)]=!0}mountSecurityCodeField(e){if(!this.securityCodeIsRequired(e?.security_code_settings))return;this.unmountCardForm(),this.unmountActiveSecurityCodeInstance(),this.setSecurityCodeReferenceFalse(e);const t=setInterval((()=>{if(document.getElementById(`mp-super-token-security-code-input-${e.token}`)){clearInterval(t);const s=3===e?.security_code_settings?.length?this.SECURITY_CODE_PLACEHOLDER_TEXT_3_DIGITS:this.SECURITY_CODE_PLACEHOLDER_TEXT_4_DIGITS,n=this.mpSdkInstance.fields.create("securityCode",{placeholder:s,ariaRequired:!0,style:{"font-size":"16px",height:"48px",padding:"14px",fontFamily:'Inter, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif'}}).mount(`mp-super-token-security-code-input-${e.token}`).on("error",(t=>this.mpSuperTokenMetrics.errorToMountCVVField(t,e))).on("ready",(()=>{if(n.update({settings:e?.security_code_settings}),this.storeActiveSecurityCodeInstance(n),this.securityCodeIsRequired(e?.security_code_settings)){const t=document.querySelector(`#mp-super-token-security-code-container-${e.token} .mp-super-token-security-code-tooltip`),s=document.querySelector(`#mp-super-token-security-code-input-${e.token}`);if(!t||!s)return;const n=t.cloneNode(!0);n.style.display="flex",s.appendChild(n)}})).on("validityChange",(t=>{this.setSecurityCodeReferenceTrue(e),0===t.errorMessages.length?("undefined"!=typeof MPCheckoutFieldsDispatcher&&MPCheckoutFieldsDispatcher?.addEventListenerDispatcher(null,"focusout","super_token_cvv_filled",{onlyDispatch:!0}),this.toggleSecurityCodeErrorMessage("",e)):this.setSecurityCodeReferenceFalse(e);const s=t.errorMessages[0]?.cause??"";this.toggleSecurityCodeErrorMessage(s,e)}))}}),200)}handleInstallmentsWithoutFeePillVisibility(e){document.querySelectorAll(".mp-super-token-payment-method").forEach((e=>{const t=e.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_VALUE_PROP}`);t&&(t.style.display="flex")}))}createPaymentMethodElement(e){const t=e?.card?.card_number?.last_four_digits,s=document.createElement("article"),n=this.numberOfInstallmentsWithoutFee(e),o=this.buildPaymentMethodAriaLabel(e,t,n),r=Math.random().toString(36).substring(2,15),i=e?.id?this.paymentMethodIdentifier(e):r,a=(this.isCreditCard(e)||this.isConsumerCredits(e))&&n>1;if(s.id=i,s.dataset.type=e?.type,s.dataset.id=i,s.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD),s.setAttribute("aria-label",o),s.setAttribute("tabindex","0"),s.setAttribute("role","option"),s.setAttribute("aria-selected","false"),s.innerHTML=`\n            <section class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_HEADER}">\n                <figure class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_THUMBNAIL}">\n                        <img src="${e?.thumbnail}" alt="${e?.name}">\n                </figure>\n                    <article class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_CONTENT}">\n                    <section class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_CONTENT_TITLE}">\n                        <span class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_TITLE}">${e?.name}</span>\n                        ${t?`<span class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LAST_FOUR_DIGITS}">**** ${t}</span>`:""}\n                    </section>\n                    ${a?`<span\n                                aria-hidden="true"\n                                class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_VALUE_PROP}">\n                                ${this.INTEREST_FREE_PART_ONE_TEXT} ${n}${"MLB"===this.getSiteId()?"x":""} ${this.INTEREST_FREE_PART_TWO_TEXT}\n                            </span>`:""}\n                    </article>\n            </section>\n            ${this.buildCreditCardDetailsInnerHTML(e)}\n            ${this.buildConsumerCreditsDetailsInnerHTML(e)}\n        `,s.addEventListener("click",(()=>{this.onSelectSuperTokenPaymentMethod.call(this,s,e)})),s.addEventListener("keydown",(t=>{"Space"!=t.code&&"Enter"!=t.key||(t.preventDefault(),this.onSelectSuperTokenPaymentMethod.call(this,s,e))})),this.isCreditCard(e)&&e.installments?.length){const t=s.querySelector(`#mp-super-token-installments-select-${this.paymentMethodIdentifier(e)}`);this.addDropdownEventListener(t),t?.addEventListener("change",(s=>{const n=s.target.value;if(n&&("undefined"!=typeof MPCheckoutFieldsDispatcher&&MPCheckoutFieldsDispatcher?.addEventListenerDispatcher(null,"focusout","super_token_installments_filled",{onlyDispatch:!0}),this.setInstallmentsErrorState(e,!1),CheckoutPage.updateTaxInfoForSelect(n,`mp-super-token-installments-tax-info-${this.paymentMethodIdentifier(e)}`,e?.installments),n)){t.value=n;const e=document.getElementById("cardInstallments");e&&(e.value=n)}})),t?.addEventListener("blur",(()=>{this.installmentsWasSelected(e)?this.setInstallmentsErrorState(e,!1):this.setInstallmentsErrorState(e,!0)}))}if(this.isConsumerCredits(e)&&e?.installments?.length){const t=s.querySelector("andes-dropdown");this.addDropdownEventListener(t);const n={fastPaymentToken:this.getSuperToken(),pricingId:e.credits_pricing_id,pseudotoken:e.token,customization:{textColor:"#000000",textSize:"13px",linkColor:"#3483FA"}};this.mpSdkInstance.renderCreditsContract("mp-consumer-credits-legal-text",n).then((s=>{t?.addEventListener("change",(n=>{this.getSiteId()===this.BRAZIL_ACCRONYM&&(this.buildMLBConsumerCreditsLegalText(),document.getElementById("mp-consumer-credits-debit-auto-text").style.display="block");const o=n?.detail;if(o&&o?.value){t.value=o.value,document.getElementById("cardInstallments").value=parseInt(o.value);const n=e.installments.find((e=>e.installments===parseInt(o.value)));n&&(t.setAttribute("hint",this.buildConsumerCreditsHint(n)),t.setAttribute("due-date",this.buildConsumerCreditsDetailsDueDate(e)),document.getElementById("mp-consumer-credits-due-date").style.display="block",document.getElementById("mp-consumer-credits-legal-text").style.display="block"),s.update({installments:o.value})}}))})).catch((e=>{console.error(e)}))}return s}convertCreditCardFormToPaymentMethodElement(e){const t=e.querySelector(this.CHECKOUT_CONTAINER_SELECTOR);(e=>{e.classList.add(this.SUPER_TOKEN_STYLES.ACCORDION),e.querySelector(this.CHECKOUT_CUSTOM_CONTAINER_SELECTOR).classList.add(this.SUPER_TOKEN_STYLES.ACCORDION_CONTENT)})(t);const s=(()=>{const e=document.createElement("section");return e.classList.add(this.SUPER_TOKEN_STYLES.ACCORDION_HEADER),e.setAttribute("aria-label",this.NEW_CARD_TEXT),e.setAttribute("tabindex","0"),e.setAttribute("role","option"),e.setAttribute("aria-selected","false"),e.innerHTML=`\n                <img src="${this.WHITE_CARD_PATH}">\n                <span class="${this.SUPER_TOKEN_STYLES.ACCORDION_TITLE}">${this.NEW_CARD_TEXT}</span>\n            `,e.addEventListener("click",(()=>{this.onSelectNewCardPaymentMethod.call(this)})),e.addEventListener("keydown",(e=>{"Space"!=e.code&&"Enter"!=e.key||(e.preventDefault(),this.onSelectNewCardPaymentMethod.call(this))})),e})();t.addEventListener("keyup",(e=>{"Tab"==e.key&&s.focus()})),t.appendChild(s)}convertCustomCheckoutAreaToPaymentMethodList(e){e.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHOD_LIST),e.setAttribute("role","listbox"),e.setAttribute("aria-label",this.PAYMENT_METHODS_LIST_ALT_TEXT),e.setAttribute("tabindex","0"),e.parentElement.classList.add("mp-box-shadow-none"),e.classList.add(this.SUPER_TOKEN_STYLES.ANIMATION_CLASS)}reorderAccountPaymentMethods(e){const t=e.filter((e=>this.isCreditCard(e)||this.isDebitCard(e)||this.isPrepaidCard(e))),s=e.find((e=>this.isAccountMoney(e))),n=e.find((e=>this.isConsumerCredits(e))),o=t.slice(0,3),r=(this.PAYMENT_METHODS_ORDER||this.PAYMENT_METHODS_ORDER_TYPE_CARDS_FIRST)===this.PAYMENT_METHODS_ORDER_TYPE_ACCOUNT_MONEY_FIRST&&s,i=[s,n].filter(Boolean);return(r?[i,...o]:[...o,i]).flat()}normalizeAccountPaymentMethods(e){return e.map((e=>(this.isAccountMoney(e)&&(e.thumbnail=this.YELLOW_WALLET_PATH,e.name=this.buildAccountMoneyName(e)),this.isConsumerCredits(e)&&(e.thumbnail=this.YELLOW_MONEY_PATH,e.name=this.buildConsumerCreditsName()),this.isMercadoPagoCard(e)&&(e.name=this.MERCADO_PAGO_CARD_NAME),this.isPrepaidCard(e)&&(e.thumbnail=this.PAYMENT_METHODS_THUMBNAILS[e.id]||this.WHITE_CARD_PATH),(this.isCreditCard(e)||this.isDebitCard(e))&&(e.thumbnail=this.PAYMENT_METHODS_THUMBNAILS[e.id]||this.WHITE_CARD_PATH,e.name=(e.issuer.name??e.name)+" "+(this.isCreditCard(e)?"Crédito":"Débito")),e)))}focusFirstPaymentMethod(){const e=this.getCustomCheckoutEntireElement().querySelector("article");if(e)return void e.focus();const t=this.getCustomCheckoutEntireElement().querySelector("section");t&&t.focus()}organizePaymentMethodsElements(e){const t=this.reorderAccountPaymentMethods(e).filter((e=>!this.isConsumerCredits(e)));this.normalizeAccountPaymentMethods(t).reverse().forEach((e=>{this.getCustomCheckoutEntireElement().insertBefore(this.createPaymentMethodElement(e),this.getCustomCheckoutEntireElement().firstChild)}))}addMercadoPagoPrivacyPolicyFooter(){const e=document.createElement("footer");e.classList.add(this.SUPER_TOKEN_STYLES.MERCADO_PAGO_PRIVACY_POLICY_FOOTER),e.id="mp-super-token-privacy-policy-footer",e.innerHTML=`<span>${this.MERCADO_PAGO_PRIVACY_POLICY}</span>`,this.getCustomCheckoutEntireElement().insertBefore(e,this.getCustomCheckoutEntireElement().firstChild)}removeMercadoPagoPrivacyPolicyFooter(){const e=this.getCustomCheckoutEntireElement()?.querySelector("#mp-super-token-privacy-policy-footer")??null;e&&e.remove()}addPaymentMethodsListHeader(e){const t=document.createElement("header");t.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHODS_LIST_HEADER),t.innerHTML=`\n            <span>${this.PAYMENT_METHODS_LIST_TEXT}</span>\n            <img alt="Mercado Pago" class="${this.SUPER_TOKEN_STYLES.PAYMENT_METHODS_LIST_HEADER_LOGO}" src="${this.NEW_MP_LOGO_PATH}">\n        `,e.insertBefore(t,e.firstChild)}removePaymentMethodsListHeader(){const e=document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHODS_LIST_HEADER}`);e&&e.remove()}showCardHolderNameHelperInfo(){const e=document.querySelector(this.CARD_HOLDER_NAME_HELPER_INFO_SELECTOR);e&&(e.style.display="flex")}addHorizontalRow(){const e=document.createElement("hr");e.classList.add(this.SUPER_TOKEN_STYLES.PAYMENT_METHODS_LIST_HORIZONTAL_ROW),this.getCustomCheckoutEntireElement().insertBefore(e,this.getCustomCheckoutEntireElement().firstChild)}removeHorizontalRow(){const e=document.querySelector(`.${this.SUPER_TOKEN_STYLES.PAYMENT_METHODS_LIST_HORIZONTAL_ROW}`);e&&e.remove()}onCustomCheckoutWasRendered(e,t){this.hideWalletButton(),this.hideCardFlags(),this.convertCustomCheckoutAreaToPaymentMethodList(e),this.addHorizontalRow(),this.addMercadoPagoPrivacyPolicyFooter(),this.organizePaymentMethodsElements(t),this.addPaymentMethodsListHeader(e),this.convertCreditCardFormToPaymentMethodElement(e),this.focusFirstPaymentMethod(),this.selectPreloadedPaymentMethod(),this.removeAnimationInitialState(),this.hideAllPaymentMethodDetails(),this.setCheckoutType(this.SUPER_TOKEN_CHECKOUT_TYPE)}removeAnimationInitialState(){const e=this.getCustomCheckoutEntireElement();e&&setTimeout((()=>{e.classList.remove(this.SUPER_TOKEN_STYLES.ANIMATION_CLASS)}),750)}forceSecurityCodeValidation(e){const t=document.getElementById(`mp-super-token-security-code-container-${e.token}`);t&&(this.securityFieldsActiveInstance?(this.securityFieldsActiveInstance.focus(),setTimeout((()=>{this.securityFieldsActiveInstance.blur(),setTimeout((()=>{t.classList.contains("error")||this.toggleSecurityCodeErrorMessage("invalid_type",e)}),100)}),50)):this.toggleSecurityCodeErrorMessage("invalid_type",e))}forceShowValidationErrors(){if(!this.activePaymentMethod)return;if(!this.isCreditCard(this.activePaymentMethod)&&!this.isDebitCard(this.activePaymentMethod))return;const e=document.getElementById(this.paymentMethodIdentifier(this.activePaymentMethod));e&&(this.securityCodeIsRequired(this.activePaymentMethod?.security_code_settings)&&!this.verifyIsSecurityCodeReferenceTrue(this.activePaymentMethod)&&this.forceSecurityCodeValidation(this.activePaymentMethod),this.isCreditCard(this.activePaymentMethod)&&!this.installmentsWasSelected(this.activePaymentMethod)&&this.setInstallmentsErrorState(this.activePaymentMethod,!0),e.scrollIntoView({behavior:"smooth"}))}isSelectedPaymentMethodValid(){try{if(this.isAccountMoney(this.activePaymentMethod)||this.isPrepaidCard(this.activePaymentMethod))return!0;if(this.activePaymentMethod.id===this.NEW_CARD_TYPE)return!0;const e=document.getElementById(this.paymentMethodIdentifier(this.activePaymentMethod));if(!e)return!1;if(e.querySelector(`#mp-super-token-installments-select-${this.paymentMethodIdentifier(this.activePaymentMethod)}`)&&this.isCreditCard(this.activePaymentMethod)&&!this.installmentsWasSelected(this.activePaymentMethod))return!1;if(!this.securityCodeIsRequired(this.activePaymentMethod?.security_code_settings))return!0;if(!this.securityFieldsActiveInstance)return!1;const t=document.getElementById(`mp-super-token-security-code-container-${this.activePaymentMethod.token}`);if(!t)return!1;if(!this.verifyIsSecurityCodeReferenceTrue(this.activePaymentMethod))return!1;const s=t.classList.contains("error"),n=t.querySelector("#mp-input-with-tooltip-helper-error"),o=n&&"flex"===n.style.display;return!s&&!o}catch(e){return console.error("Error validating selected payment method after submit: ",e),!1}}renderAccountPaymentMethods(e,t){if(this.storeAmount(t),this.storeActivePaymentMethod(this.getPaymentMethodSelectedFromDOMToAccountPaymentMethods(e)),this.paymentMethodsAreRendered())return;this.hasStoredPaymentMethods()||this.storePaymentMethodsInMemory(e);const s=this.getCustomCheckoutEntireElement();if(!s)throw new Error(MPSuperTokenErrorCodes.CUSTOM_CHECKOUT_ENTIRE_ELEMENT_NOT_FOUND);this.onCustomCheckoutWasRendered(s,e),setTimeout((()=>{const e=this.mpSuperTokenMetrics.getSdkInstanceId();document.dispatchEvent(new CustomEvent("supertoken_loaded",{detail:{sdkInstanceId:e}}))}),500)}}