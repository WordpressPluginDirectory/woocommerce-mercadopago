function clearMessage(){document.querySelector(".mp-alert").remove()}function selectTestMode(e){const t=document.getElementById("mp-mode-badge"),n=document.getElementById("mp-orange-badge"),s=document.getElementById("mp-icon-badge"),o=document.getElementById("mp-helper-test"),a=document.getElementById("mp-helper-prod"),i=document.getElementById("mp-title-helper-prod"),c=document.getElementById("mp-title-helper-test"),d=document.getElementById("mp-mode-badge-test"),m=document.getElementById("mp-mode-badge-prod");if(e)t.classList.remove("mp-settings-prod-mode-alert"),t.classList.add("mp-settings-test-mode-alert"),n.classList.remove("mp-settings-alert-payment-methods-green"),n.classList.add("mp-settings-alert-payment-methods-orange"),s.classList.remove("mp-settings-icon-success"),s.classList.add("mp-settings-icon-warning"),mpVerifyAlertTestMode(),o.style.display="block",a.style.display="none",c.style.display="block",i.style.display="none",d.style.display="block",m.style.display="none";else{const e=document.getElementById("mp-red-badge").parentElement;t.classList.remove("mp-settings-test-mode-alert"),t.classList.add("mp-settings-prod-mode-alert"),e.style.display="none",n.classList.remove("mp-settings-alert-payment-methods-orange"),n.classList.add("mp-settings-alert-payment-methods-green"),s.classList.remove("mp-settings-icon-warning"),s.classList.add("mp-settings-icon-success"),o.style.display="none",a.style.display="block",c.style.display="none",i.style.display="block",d.style.display="none",m.style.display="block"}}function mpVerifyAlertTestMode(){return!document.querySelector('input[name="mp-test-prod"]').checked||""!==document.getElementById("mp-public-key-test").value&&""!==document.getElementById("mp-access-token-test").value?(document.getElementById("mp-red-badge").parentElement.style.display="none",!1):(document.getElementById("mp-red-badge").parentElement.style.display="flex",!0)}function mpShowSnackbar(e,t){const n=jQuery(`\n    <div class="mp-snackbar">\n      <div class="mp-snackbar-${t}">\n        ${e}\n      </div>\n    </div>\n  `);jQuery(".mp-settings").append(n),setTimeout((()=>n.remove()),5e3)}function mpValidateStoreTips(){const e=document.getElementById("mp-settings-icon-store");jQuery.post(ajaxurl,{action:"mp_validate_store_tips",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.remove("mp-settings-icon-store"),e.classList.add("mp-settings-icon-success")):e.classList.remove("mp-settings-icon-success")})).fail((function(){e.classList.remove("mp-settings-icon-success")}))}function mpValidatePaymentTips(){const e=document.getElementById("mp-settings-icon-payment");jQuery.post(ajaxurl,{action:"mp_validate_payment_tips",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.remove("mp-settings-icon-payment"),e.classList.add("mp-settings-icon-success")):e.classList.remove("mp-settings-icon-success")})).fail((function(){e.classList.remove("mp-settings-icon-success")}))}function mpGoToNextStep(e,t,n,s){const o=document.getElementById(e),a=document.getElementById(n),i=document.getElementById(t),c=document.getElementById(s);if(o.style.display="none",i.style.display="block",a.classList.remove("mp-arrow-up"),c.classList.add("mp-arrow-up"),window.melidata&&window.melidata.client&&window.melidata.client.addStoreConfigurationsStepTimer)switch(t){case"mp-step-2":window.melidata.client.addStoreConfigurationsStepTimer({step:"business"});break;case"mp-step-3":window.melidata.client.addStoreConfigurationsStepTimer({step:"payment_methods",sendOnClose:!0});break;case"mp-step-4":window.melidata.client.addStoreConfigurationsStepTimer({step:"mode"})}}function mpContinueToNextStep(){document.getElementById("mp-payment-method-continue").addEventListener("click",(function(){mpGoToNextStep("mp-step-3","mp-step-4","mp-payments-arrow-up","mp-modes-arrow-up")}))}function mpGetRequirements(){jQuery.post(ajaxurl,{action:"mp_get_requirements",nonce:mercadopago_settings_admin_js_params.nonce},(function(e){const t={ssl:document.getElementById("mp-req-ssl"),gd_ext:document.getElementById("mp-req-gd"),curl_ext:document.getElementById("mp-req-curl")};for(let n in t){const s=t[n];s.style="",e.data[n]||(s.classList.remove("mp-settings-icon-success"),s.classList.add("mp-settings-icon-warning"))}}))}function mpGetPaymentMethods(){jQuery.post(ajaxurl,{action:"mp_get_payment_methods",nonce:mercadopago_settings_admin_js_params.nonce},(function(e){const t=document.getElementById("mp-payment");document.querySelectorAll(".mp-settings-payment-block").forEach((e=>{e.remove()})),e.data.reverse().forEach((e=>{t.insertAdjacentElement("afterend",createMpPaymentMethodComponent(e))})),window.melidata&&window.melidata.client&&window.melidata.client.stepPaymentMethodsCallback&&window.melidata.client.stepPaymentMethodsCallback()}))}function createMpPaymentMethodComponent(e){const t="yes"===e.enabled?"mp-settings-badge-active":"mp-settings-badge-inactive",n="yes"===e.enabled?e.badge_translator.yes:e.badge_translator.no,s=document.createElement("div");return s.appendChild(getPaymentMethodComponent(e,t,n)),s}function getPaymentMethodComponent(e,t,n){const s=`\n    <a href="${e.link}" class="mp-settings-link mp-settings-font-color">\n      <div class="mp-block mp-block-flex mp-settings-payment-block mp-settings-align-div">\n        <div class="mp-settings-align-div">\n          <div class="mp-settings-icon">\n            <img src="${e.icon}" alt="mp gateway icon" />\n          </div>\n\n          <span class="mp-settings-subtitle-font-size mp-settings-margin-title-payment">\n            <b>${e.title_gateway}</b> - ${e.description}\n          </span>\n\n          <span class="${t}">${n}</span>\n        </div>\n\n        <div class="mp-settings-title-align">\n        <span class="mp-settings-text-payment">Configurar</span>\n          <div class="mp-settings-icon-config"></div>\n        </div>\n      </div>\n    </a>\n  `;return(new DOMParser).parseFromString(s,"text/html").firstChild}function mpSettingsAccordionStart(){let e;const t=document.getElementsByClassName("mp-settings-title-align");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("active");let e=null;for(let t=0;t<this.childNodes.length;t++)if(this.childNodes[t]?.classList?.contains("mp-settings-margin-left")){e=this.childNodes[t];break}e?.childNodes[1]?.classList?.toggle("mp-arrow-up");const t=this.nextElementSibling;"block"===t.style.display?t.style.display="none":t.style.display="block"}))}function mpSettingsAccordionOptions(){const e=document.getElementById("mp-advanced-options"),t=document.getElementById("block-two");e.addEventListener("click",(function(){this.classList.toggle("active");const n=this.nextElementSibling;"block"===n.style.display?n.style.display="none":n.style.display="block",e.classList.contains("active")||t.classList.contains("mp-settings-flex-start")?(e.textContent=mercadopago_settings_admin_js_params.hide_advanced_text,t.classList.remove("mp-settings-flex-start")):(t.classList.toggle("mp-settings-flex-start"),e.textContent=mercadopago_settings_admin_js_params.show_advanced_text)}))}function mpUpdateOptionCredentials(){document.getElementById("mp-btn-credentials")?.addEventListener("click",(function(){setTimeout((()=>{mpGoToNextStep("mp-step-1","mp-step-2","mp-credentials-arrow-up","mp-store-info-arrow-up")}),2e3)}))}function mpUpdateTestCredentials(){document.getElementById("mp-btn-update-test-credentials")?.addEventListener("click",(function(){document.getElementById("msg-info-credentials").childNodes.length>=1&&document.querySelector(".mp-card-info").remove(),hideCredentialsErrors(document.getElementById("mp-test-access-token"),document.getElementById("mp-modal-alert-access-token")),hideCredentialsErrors(document.getElementById("mp-test-public-key"),document.getElementById("mp-modal-alert-public-key")),jQuery.post(ajaxurl,{public_key_test:document.getElementById("mp-public-key-test").value,access_token_test:document.getElementById("mp-access-token-test").value,action:"mp_update_option_credentials",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(e){mpGetPaymentMethods(),e.success?(document.getElementById("mp-credentials-modal").style.display="none",mpVerifyAlertTestMode(),mpShowSnackbar(e.data,"success")):(showCredentialsError("public-key",e.data.message),showCredentialsError("access-token",e.data.message))})).fail((function(e){mpShowSnackbar(e?.data,"error")}))}))}function hideCredentialsErrors(e,t){if(t&&t.remove(),e){const t=e.getElementsByTagName("label")[0],n=e.getElementsByTagName("input")[0];t.classList.contains("mp-settings-modal-text-alert")&&t.classList.remove("mp-settings-modal-text-alert"),n.classList.contains("mp-settings-modal-input-alert")&&n.classList.remove("mp-settings-modal-input-alert")}}function showCredentialsError(e,t){document.getElementById("mp-test-"+e).getElementsByTagName("label")[0].classList.add("mp-settings-modal-text-alert"),document.getElementById("mp-test-"+e).getElementsByTagName("input")[0].classList.add("mp-settings-modal-input-alert");const n=document.createElement("p");n.innerText=t;const s=document.createElement("div");s.className="mp-modal-alert",s.id="mp-modal-alert-"+e,s.appendChild(n),document.getElementById("mp-test-"+e).appendChild(s)}function mpUpdateStoreInformation(){document.getElementById("mp-store-info-save").addEventListener("click",(function(){jQuery.post(ajaxurl,{store_url_ipn:document.querySelector("#mp-store-url-ipn").value,store_url_ipn_options:document.querySelector("#mp-store-url-ipn-options").checked?"yes":"no",store_categories:document.getElementById("mp-store-categories").value,store_category_id:document.getElementById("mp-store-category-id").value,store_integrator_id:document.getElementById("mp-store-integrator-id").value,store_identificator:document.getElementById("mp-store-identification").value,store_debug_mode:document.querySelector("#mp-store-debug-mode:checked")?.value,store_cron_config:document.getElementById("mp-store-cron-config")?.value,action:"mp_update_store_information",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(e){e.success?(mpValidateStoreTips(),mpShowSnackbar(e.data,"success"),setTimeout((()=>{mpGoToNextStep("mp-step-2","mp-step-3","mp-store-info-arrow-up","mp-payments-arrow-up")}),3e3)):mpShowSnackbar(e.data,"error")})).fail((function(e){mpShowSnackbar(e?.data,"error")}))}))}function mpUpdateTestMode(){const e=document.querySelectorAll('input[name="mp-test-prod"]');e[0].addEventListener("change",(function(){e[0].checked&&selectTestMode(!0)})),e[1].addEventListener("change",(function(){e[1].checked&&selectTestMode(!1)})),document.getElementById("mp-store-mode-save").addEventListener("click",(function(){jQuery.post(ajaxurl,{input_mode_value:document.querySelector('input[name="mp-test-prod"]:checked').value,input_verify_alert_test_mode:mpVerifyAlertTestMode()?"yes":"no",action:"mp_update_test_mode",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?mpShowSnackbar(t.data,"success"):(e[0].checked&&(document.getElementById("mp-red-badge").parentElement.style.display="flex"),mpShowSnackbar(t.data,"error"))})).fail((function(e){mpShowSnackbar(e.data,"error")}))}))}function mpSwitchAccount(){jQuery("#mp-switch-account-btn").click((()=>{jQuery("#mp-settings-credentials-linked").addClass("mp-hidden"),jQuery("#mp-settings-credentials-country").removeClass("mp-hidden")}))}async function waitForMPDeviceSessionID(e){const t=Date.now();return new Promise(((n,s)=>{const o=setInterval((()=>{"undefined"!=typeof MP_DEVICE_SESSION_ID&&MP_DEVICE_SESSION_ID?(clearInterval(o),n(MP_DEVICE_SESSION_ID)):Date.now()-t>e&&(clearInterval(o),s(new Error("Timeout waiting for MP_DEVICE_SESSION_ID")))}),100)}))}async function mpRedirectSellerToIntegrationAuthLogin(){try{const e=await waitForMPDeviceSessionID(5e3);jQuery.post(ajaxurl,{action:"mp_integration_login",site_id:jQuery("#mp-credentials-country").val(),device_fingerprint:e,nonce:mercadopago_settings_admin_js_params.nonce}).done((function(e){e.success?window.location.href=e.data.onboarding_url:redirectToOnBoardingError()})).fail((function(){redirectToOnBoardingError()}))}catch(e){redirectToOnBoardingError(),console.error("Failed to get MP_DEVICE_SESSION_ID:",e.message)}}function mpIntegrationAuthLogin(){jQuery("#mp-integration-auth-login, #mp-integration-auth-login-update")?.click((async function(e){const t=e.target;t.disabled=!0,t.classList.add("mp-disabled-button");try{await mpRedirectSellerToIntegrationAuthLogin()}catch(e){redirectToOnBoardingError(),console.error("Error when executing mpRedirectSellerToIntegrationAuthLogin:",e.message)}}))}function redirectTo(e){window.location.href=e}function redirectToOnBoardingError(){redirectTo(window.location.href+"&onboarding_error=true")}function mpIntegrationAuthFailed(){jQuery("#mp-integration-auth-failed")?.click((function(){const e=new URL(window.location.href);e.searchParams.delete("onboarding_error"),window.history.replaceState({},"",e.toString()),window.location.reload()}))}function mpCredentialsInputListeners(){document.getElementById("mp-test-access-token")&&document.getElementById("mp-test-access-token").addEventListener("change",(function(){hideCredentialsErrors(this,document.getElementById("mp-modal-alert-access-token"))})),document.getElementById("mp-test-public-key")&&document.getElementById("mp-test-public-key").addEventListener("change",(function(){hideCredentialsErrors(this,document.getElementById("mp-modal-alert-public-key"))}))}function mpCredentialsModalButtonsListeners(){document.getElementById("mp-settings-auto-data-consult")&&document.getElementById("mp-settings-auto-data-consult").addEventListener("click",(function(){document.getElementById("mp-credentials-modal").style.display="flex"})),document.getElementById("mp-credentials-close-modal")&&document.getElementById("mp-credentials-close-modal").addEventListener("click",(function(){document.getElementById("mp-credentials-modal").style.display="none"})),document.getElementById("mp-production-token-button")&&document.getElementById("mp-production-token-button").addEventListener("click",(function(){switchVisibility("production")})),document.getElementById("mp-test-token-button")&&document.getElementById("mp-test-token-button").addEventListener("click",(function(){switchVisibility("test")}))}function switchVisibility(e){const t=document.getElementById("mp-access-token-"+e),n=document.getElementById("mp-"+e+"-token-img"),s=document.getElementById("mp-"+e+"-token-button"),o=n.classList;"password"===t.type?(t.type="text",s.ariaLabel=mercadopago_settings_admin_js_params.hide_access_token,n.title=mercadopago_settings_admin_js_params.hide_access_token,o.remove("mp-access-token-button-closed"),o.add("mp-access-token-button-open")):(t.type="password",s.ariaLabel=mercadopago_settings_admin_js_params.show_access_token,n.title=mercadopago_settings_admin_js_params.show_access_token,o.remove("mp-access-token-button-open"),o.add("mp-access-token-button-closed"))}function mpSelectCredentialsCountry(){const e=jQuery("#mp-settings-credentials-country"),t=jQuery("#mp-button-country"),n=e.find("#mp-credentials-country"),s=n.parents("#mp-settings-credentials-country .mp-select"),o=n.parents(".mp-input-group"),a=e.find("#mp-button-country"),i=()=>{e.toggleClass("mp-hidden"),jQuery(t.data("next")).toggleClass("mp-hidden")};n.change((()=>{o.removeClass("mp-error"),a.removeClass("mp-button-error"),a.focus()})),t.click((()=>{if(n.val()){if(t.data("switch-account"))return t.prop("disabled",!0),t.addClass("mp-disabled-button"),void mpRedirectSellerToIntegrationAuthLogin();i(),mpShowSnackbar(t.data("success").replace("{{country}}",s.find("[aria-selected=true]").text()),"success")}else{o.addClass("mp-error"),a.addClass("mp-button-error");jQuery(".mp-input-group.mp-error .mp-error-msg").focus()}})),jQuery("#mp-credentials-change-country").click(i)}function mpSelect(){jQuery(".mp-select ul").on("open",(e=>{const t=jQuery(e.target),n=t.parents(".mp-select");jQuery("#mp-credentials-country-select button").addClass("mp-select-button-focus"),t.removeClass("mp-hidden"),n.attr("aria-expanded","true")})),jQuery(".mp-select ul").on("close",(e=>{const t=jQuery(e.target),n=t.parents(".mp-select");t.addClass("mp-hidden"),n.attr("aria-expanded","false"),jQuery("#mp-credentials-country-select button").removeClass("mp-select-button-focus")})),jQuery(".mp-select button").click((e=>{e.stopPropagation();jQuery(e.target).parent(".mp-select").find("ul").trigger("open"),jQuery("#mp-credentials-country-select ul").focus()})),jQuery("body").click((()=>jQuery(".mp-select ul").trigger("close"))),jQuery(".mp-select li").click((e=>{const t=jQuery(e.target),n=t.parents(".mp-select"),s=n.find("ul"),o=s.find("li"),a=n.find("input"),i=n.find("button");s.trigger("close"),a.val(t.data("value")).trigger("change"),i.text(t.text()),o.attr("aria-selected",!1),t.attr("aria-selected",!0)}))}function mp_settings_screen_load(){mpGetRequirements(),mpGetPaymentMethods(),mpSettingsAccordionStart(),mpSettingsAccordionOptions(),mpCredentialsInputListeners(),mpValidateStoreTips(),mpValidatePaymentTips(),mpVerifyAlertTestMode(),mpUpdateOptionCredentials(),mpUpdateTestCredentials(),mpUpdateStoreInformation(),mpUpdateTestMode(),mpContinueToNextStep(),mpIntegrationAuthLogin(),mpIntegrationAuthFailed(),mpCredentialsModalButtonsListeners(),mpSelectCredentialsCountry(),mpSelect(),mpSwitchAccount(),mpKeepStepOneOpenOnLoad(),mpDeactivateProdModeRadio()}function openSupportModal(){document.getElementById("supportModal").style.display="block"}function closeSupportModal(){document.getElementById("supportModal").style.display="none"}function mpKeepStepOneOpenOnLoad(){document.getElementById("mp-step-1").style.display="block",document.querySelector("#mp-settings-step-one img#mp-credentials-arrow-up").classList.add("mp-arrow-up")}function mpDeactivateProdModeRadio(){const e=document.getElementById("mp-settings-testmode-prod"),t=document.getElementById("mp-settings-testmode-test"),n=mpHasNotProdKeys();n?jQuery.post(ajaxurl,{input_mode_value:document.querySelector('input[name="mp-test-prod"]:checked').value,input_verify_alert_test_mode:mpVerifyAlertTestMode()?"yes":"no",action:"mp_update_test_mode",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(s){s.success?(t.checked=!0,e.checked=!1,e.disabled=!0,selectTestMode(!0)):!s.success&&n&&(e.disabled=!0)})):e.disabled=!1}function mpHasNotProdKeys(){const e=""===document.getElementById("mp-public-key-prod")?.value||""===document.getElementById("mp-access-token-production")?.value,t=!document.getElementById("mp-public-key-prod")||!document.getElementById("mp-access-token-production");return e||t}document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll('input[name="selected_files[]"]'),t=document.getElementById("downloadSelected");let n=1;function s(){const t=8*(n-1),s=t+8;e.forEach(((e,n)=>{e.closest("tr").style.display=n>=t&&n<s?"table-row":"none"}))}s(),function t(){const o=Math.ceil(e.length/8),a=document.getElementById("mp-pagination");a.innerHTML="";for(let e=1;e<=o;e++){const o=document.createElement("span");o.textContent=e,o.classList.add("mp-page-span"),e===n&&o.classList.add("active"),o.addEventListener("click",(function(){n=e,s(),t()})),a.appendChild(o)}}(),e.forEach((n=>{n.addEventListener("change",(function(){let n=!1;e.forEach((e=>{e.checked&&(n=!0)})),t.disabled=!n}))}));const o=document.getElementById("selectAllCheckbox");o.addEventListener("change",(function(){e.forEach((e=>{e.checked=o.checked})),t.disabled=!o.checked}))}));