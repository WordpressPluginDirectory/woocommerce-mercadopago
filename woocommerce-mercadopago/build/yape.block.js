(()=>{"use strict";var e={20:(e,t,s)=>{var o=s(609),n=Symbol.for("react.element"),r=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,s){var o,i={},p=null,d=null;for(o in void 0!==s&&(p=""+s),void 0!==t.key&&(p=""+t.key),void 0!==t.ref&&(d=t.ref),t)r.call(t,o)&&!a.hasOwnProperty(o)&&(i[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===i[o]&&(i[o]=t[o]);return{$$typeof:n,type:e,key:p,ref:d,props:i,_owner:c.current}}t.jsx=i,t.jsxs=i},609:e=>{e.exports=window.React},848:(e,t,s)=>{e.exports=s(20)}},t={};const s=window.wc.wcBlocksRegistry,o=window.wc.wcSettings,n=window.wp.element,r=window.wp.htmlEntities,c="mercadopago_blocks_update_cart";var a=function s(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,s),r.exports}(848);const i=({description:e,linkText:t,linkSrc:s,checkoutClass:o="pro"})=>(0,a.jsx)("div",{className:`mp-checkout-${o}-terms-and-conditions`,children:(0,a.jsx)("terms-and-conditions",{description:e,"link-text":t,"link-src":s})}),p=({title:e,description:t,linkText:s,linkSrc:o})=>(0,a.jsx)("div",{className:"mp-test-mode-container",children:(0,a.jsx)("test-mode",{title:e,description:t,"link-text":s,"link-src":o})}),d=({labelMessage:e,emptyErrorMessage:t,invalidErrorMessage:s})=>(0,a.jsx)("input-field",{"label-message":e,"empty-error-message":t,"invalid-error-message":s}),l=({label:e,src:t,emptyErrorMessage:s,invalidErrorMessage:o,tooltipText:n})=>(0,a.jsx)("input-code",{label:e,src:t,"empty-error-message":s,"invalid-error-message":o,"tooltip-text":n}),m=({message:e,src:t,icon:s,footerText:o})=>(0,a.jsx)("checkout-notice",{message:e,src:t,icon:s,"footer-text":o}),u=({text:e,imgSrc:t,id:s})=>(0,a.jsxs)("div",{id:s,className:"row-image-select",children:[(0,a.jsx)("img",{src:t}),(0,a.jsx)("p",{children:e})]});var _;const y="mp_checkout_blocks",k="woo-mercado-pago-yape",h=(0,o.getSetting)("woo-mercado-pago-yape_data",{}),g=(0,r.decodeEntities)(h.title)||"Checkout Yape";let x=!1;const f=()=>{const e=(0,r.decodeEntities)(h?.params?.fee_title||""),t=`${g} ${e}`;return(0,a.jsx)(u,{text:t,imgSrc:h.params.checkout_blocks_row_image_src})},w=e=>{(e=>{const{extensionCartUpdate:t}=wc.blocksCheckout,{eventRegistration:s,emitResponse:o}=e,{onPaymentSetup:r,onCheckoutSuccess:a,onCheckoutFail:i}=s;(0,n.useEffect)((()=>{((e,t)=>{e({namespace:c,data:{action:"add",gateway:t}})})(t,k);const e=r((()=>({type:o.responseTypes.SUCCESS})));return()=>(((e,t)=>{e({namespace:c,data:{action:"remove",gateway:t}})})(t,k),e())}),[r]),(0,n.useEffect)((()=>{const e=a((async e=>{const t=e.processingResponse;return sendMetric("MP_YAPE_BLOCKS_SUCCESS",t.paymentStatus,y),{type:o.responseTypes.SUCCESS}}));return()=>e()}),[a]),(0,n.useEffect)((()=>{const e=i((e=>{"undefined"!=typeof MPCheckoutErrorDispatcher&&MPCheckoutErrorDispatcher.dispatchEventWhenBlocksCheckoutErrorOccurred(e);const t=e.processingResponse;return sendMetric("MP_YAPE_BLOCKS_ERROR",t.paymentStatus,y),{type:o.responseTypes.FAIL,messageContext:o.noticeContexts.PAYMENTS,message:t.paymentDetails.message}}));return()=>e()}),[i])})(e);const{test_mode:t,test_mode_title:s,test_mode_description:o,test_mode_link_text:r,test_mode_link_src:u,terms_and_conditions_description:_,terms_and_conditions_link_text:g,terms_and_conditions_link_src:f,input_field_label:w,yape_title:E,yape_subtitle:v,input_code_icon:S,checkout_notice_icon_one:j,checkout_notice_icon_two:C,checkout_notice_message:b,input_code_label:R,footer_text:T,yape_tooltip_text:M,yape_input_code_error_message1:N,yape_input_code_error_message2:P,yape_phone_number_error_message1:O,yape_phone_number_error_message2:I}=h.params,B=(0,n.useRef)(null),{eventRegistration:D,emitResponse:F}=e,{onPaymentSetup:L}=D;return window.mpFormId="blocks_checkout_form",window.mpCheckoutForm=document.querySelector(".wc-block-components-form.wc-block-checkout__form"),(0,n.useEffect)((()=>{x||("undefined"!=typeof MPCheckoutFieldsDispatcher&&MPCheckoutFieldsDispatcher?.addEventListenerDispatcher(document.getElementById("checkout__yapePhoneNumber"),"focusout","yape_phone_number_filled",{dispatchOnlyIf:e=>e?.target?.value.length}),x=!0)}),[]),(0,n.useEffect)((()=>{const e=L((async()=>{const e=getCodeValue(),t=document.getElementById("checkout__yapePhoneNumber").value.replaceAll(" ","");if(""===e&&""===t)return document.getElementsByTagName("input-field")[0].validate(),document.getElementsByTagName("input-code")[0].validate(),{type:F.responseTypes.ERROR};const s={otp:e,phoneNumber:t},o={};if(!window.mpSdkInstance){const e=new MercadoPago(wc_mercadopago_yape_checkout_params.public_key);window.mpSdkInstance=e}const n=window.mpSdkInstance.yape(s);try{const e=await n.create();o["mercadopago_yape[token]"]=e.id}catch(e){return console.warn("Token creation error: ",e),{type:F.responseTypes.ERROR}}return{type:F.responseTypes.SUCCESS,meta:{paymentMethodData:{...window.mpHiddenInputDataFromBlocksCheckout,...o}}}}));return()=>e()}),[L,F.responseTypes.ERROR,F.responseTypes.SUCCESS]),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mp-checkout-custom-load",children:(0,a.jsx)("div",{className:"spinner-card-form"})}),(0,a.jsxs)("div",{className:"mp-checkout-yape-container",children:[(0,a.jsxs)("div",{ref:B,className:"mp-checkout-yape-content",children:[t?(0,a.jsx)(p,{title:s,description:o,linkText:r,linkSrc:u}):null,(0,a.jsxs)("div",{className:"mp-checkout-yape-title-container",children:[(0,a.jsx)("h2",{className:"mp-checkout-yape-title",children:E}),(0,a.jsx)("p",{className:"mp-checkout-yape-subtitle",children:v})]}),(0,a.jsxs)("div",{className:"mp-checkout-yape-inputs",children:[(0,a.jsx)(d,{labelMessage:w,emptyErrorMessage:O,invalidErrorMessage:I}),(0,a.jsx)(l,{label:R,src:S,emptyErrorMessage:N,invalidErrorMessage:P,tooltipText:M})]}),(0,a.jsxs)(m,{message:b,src:j,icon:C,children:["footerText=",T]})]}),(0,a.jsx)("div",{className:"mp-checkout-yape-terms-and-conditions",children:(0,a.jsx)(i,{description:_,linkText:g,linkSrc:f})})]}),(0,a.jsx)("div",{id:"mercadopago-utilities",style:{display:"none"},children:(0,a.jsx)("input",{type:"hidden",id:"yapeToken",name:"mercadopago_yape[token]"})})]})},E={name:k,label:(0,a.jsx)(f,{}),content:(0,a.jsx)(w,{}),edit:(0,a.jsx)(w,{}),canMakePayment:()=>!0,ariaLabel:g,supports:{features:null!==(_=h?.supports)&&void 0!==_?_:[]}};(0,s.registerPaymentMethod)(E)})();