(()=>{"use strict";var e={20:(e,o,t)=>{var r=t(609),n=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function i(e,o,t){var r,i={},u=null,d=null;for(r in void 0!==t&&(u=""+t),void 0!==o.key&&(u=""+o.key),void 0!==o.ref&&(d=o.ref),o)a.call(o,r)&&!s.hasOwnProperty(r)&&(i[r]=o[r]);if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===i[r]&&(i[r]=o[r]);return{$$typeof:n,type:e,key:u,ref:d,props:i,_owner:c.current}}o.jsx=i,o.jsxs=i},609:e=>{e.exports=window.React},848:(e,o,t)=>{e.exports=t(20)}},o={};const t=window.wc.wcBlocksRegistry,r=window.wc.wcSettings,n=window.wp.element,a=window.wp.htmlEntities,c="mercadopago_blocks_update_cart",s=(e,o)=>e({namespace:c,data:{action:"add",gateway:o}});const i=window.wc.wcBlocksData,u=window.wp.data;var d=function t(r){var n=o[r];if(void 0!==n)return n.exports;var a=o[r]={exports:{}};return e[r](a,a.exports,t),a.exports}(848);const m=({text:e,imgSrc:o,id:t})=>(0,d.jsxs)("div",{id:t,className:"row-image-select",children:[(0,d.jsx)("img",{src:o}),(0,d.jsx)("span",{children:e})]});var p;const l="mp_checkout_blocks",w="woo-mercado-pago-custom",_=(0,r.getSetting)("woo-mercado-pago-custom_data",{}),S=(0,a.decodeEntities)(_.title)||"Checkout Custom",y=()=>{const e=(0,a.decodeEntities)(_?.params?.fee_title||""),o=`${S} ${e}`;return(0,d.jsx)(m,{text:o,imgSrc:_.params.icon})},f=e=>{const{eventRegistration:o,emitResponse:t,onSubmit:r}=e,{onPaymentSetup:a,onCheckoutSuccess:m,onCheckoutFail:p}=o,[S,y]=(0,n.useState)(null),{extensionCartUpdate:f}=wc.blocksCheckout;return(0,n.useEffect)((()=>(s(f,w).then((e=>{y(e?.totals?.total_price)})).catch((e=>{console.error(e)})),()=>(((e,o)=>{e({namespace:c,data:{action:"remove",gateway:o}})})(f,w),a((()=>({type:t.responseTypes.SUCCESS})))()))),[a]),(0,n.useEffect)((()=>{e.billing.cartTotal.value==S?async function(e,o,t=1){try{for(window.mpSuperTokenPaymentMethods?.hideSuperTokenError(),window.mpCustomCheckoutHandler.cardForm.createLoadSpinner();!window.mpCustomCheckoutHandler;)await new Promise((e=>setTimeout(e,100)));const r=window.mpCustomCheckoutHandler,n=!!document.querySelector(".wc-block-components-spinner");r.cardForm.formMounted&&!n&&r.cardForm.form.unmount();let a=function(e,o){if(!Number.isInteger(e)||"object"!=typeof o)throw new Error("Invalid input");return(e/Math.pow(10,o.minorUnit)).toFixed(o.minorUnit).split(".").join(".")}(e,o);const c=parseFloat(t);c>0&&(a=String(parseFloat(a)*c)),await Promise.all([r.cardForm.initCardForm(a),window.mpSuperTokenTriggerHandler?.loadSuperToken(a)])}catch(e){"function"==typeof sendMetric&&sendMetric("error_to_update_cart_total",e?.message||"Unknown error","mp_cart_total_change_error")}finally{setTimeout((()=>mpCustomCheckoutHandler?.cardForm?.removeLoadSpinner()),500)}}(e.billing.cartTotal.value,e.billing.currency,_.params.currencyRatio):s(f,w).then((e=>{y(e?.totals?.total_price)})).catch((e=>{console.error(e)}))}),[e.billing.cartTotal.value,S]),(0,n.useEffect)((()=>{const e=a((async()=>{switch(window.mpSuperTokenPaymentMethods?.hideSuperTokenError(),document.querySelector("#mp_checkout_type")?.value){case"super_token":try{const e=window.mpSuperTokenPaymentMethods,o=window.mpSuperTokenAuthenticator,t=window.mpSuperTokenMetrics;if(!e)throw new Error(MPSuperTokenErrorCodes.SUPER_TOKEN_PAYMENT_METHODS_NOT_FOUND);if(!o)throw new Error(MPSuperTokenErrorCodes.SUPER_TOKEN_AUTHENTICATOR_NOT_FOUND);if(!t)throw new Error(MPSuperTokenErrorCodes.SUPER_TOKEN_METRICS_NOT_FOUND);t.registerClickOnPlaceOrderButton();const r=e.getActivePaymentMethod(),n=r&&e.isSelectedPaymentMethodValid();if(r&&!n&&e.forceShowValidationErrors(),(0,u.select)(i.VALIDATION_STORE_KEY).hasValidationErrors()){e.selectLastPaymentMethodChoosen();break}if(!r)throw new Error(MPSuperTokenErrorCodes.SELECT_PAYMENT_METHOD_ERROR);if(!n)throw new Error(MPSuperTokenErrorCodes.SELECT_PAYMENT_METHOD_NOT_VALID);await o.authorizePayment(r.token),await e.updateSecurityCode()}catch(e){return window.mpSuperTokenErrorHandler?.handleError(e),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:t.responseTypes.ERROR}}break;case"wallet_button":break;default:try{const e=await window.mpCustomCheckoutHandler.cardForm.form.createCardToken();document.querySelector("#cardTokenId").value=e.token}catch(e){return console.warn("token creation error after submit: ",e),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),window.mpCustomCheckoutHandler.cardForm.scrollToCardForm(),{type:t.responseTypes.ERROR}}if("undefined"!=typeof CheckoutPage&&!CheckoutPage.verifyInstallmentsContainer())return window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:t.responseTypes.ERROR}}const e=document.querySelector("#mercadopago-utilities"),o={};e&&e.querySelectorAll("input[name]").forEach((e=>{o[e.name]=e.value}));const r=document.querySelector("#form-checkout__identificationType"),n=document.querySelector("#form-checkout__identificationNumber");return r&&r.value&&(o["mercadopago_custom[doc_type]"]=r.value),n&&n.value&&(o["mercadopago_custom[doc_number]"]=n.value),{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:{...window.mpHiddenInputDataFromBlocksCheckout,...o}}}}));return()=>e()}),[a]),(0,n.useEffect)((()=>()=>{const e=window.mpSuperTokenPaymentMethods;e?.securityFieldsActiveInstance&&"function"==typeof e.unmountActiveSecurityCodeInstance&&e.unmountActiveSecurityCodeInstance();const o=window.mpCustomCheckoutHandler?.cardForm;o?.formMounted&&o?.form&&"function"==typeof o.form.unmount&&o.form.unmount()}),[]),(0,n.useEffect)((()=>{const e=m((async e=>{const o=e.processingResponse,r=e.processingResponse.paymentDetails;if(r.three_ds_flow){const e=new Promise(((e,o)=>{window.addEventListener("completed_3ds",(t=>{t.detail.error&&o(t.detail.error),e()}))}));return window.mpCustomCheckoutHandler.threeDSHandler.load3DSFlow(r.last_four_digits),await e.then((()=>({type:t.responseTypes.SUCCESS}))).catch((e=>({type:t.responseTypes.FAIL,message:e,messageContext:t.noticeContexts.PAYMENTS})))}return sendMetric("MP_CUSTOM_BLOCKS_SUCCESS",o.paymentStatus,l),{type:t.responseTypes.SUCCESS}}));return()=>e()}),[m]),(0,n.useEffect)((()=>{const e=p((e=>{"undefined"!=typeof MPCheckoutErrorDispatcher&&MPCheckoutErrorDispatcher.dispatchEventWhenBlocksCheckoutErrorOccurred(e),window.mpSuperTokenTriggerHandler?.resetSuperTokenOnError();const o=e.processingResponse;return sendMetric("MP_CUSTOM_BLOCKS_ERROR",o.paymentStatus,l),{type:t.responseTypes.FAIL,messageContext:t.noticeContexts.PAYMENTS,message:o.paymentDetails.message}}));return()=>e()}),[p]),(0,n.useEffect)((()=>{window.mpFormId="blocks_checkout_form",window.mpCheckoutForm=document.querySelector(".wc-block-components-form.wc-block-checkout__form"),window.mpCheckoutForm&&jQuery(window.mpCheckoutForm).prop("id",window.mpFormId);const e=document.getElementById("mp-wallet-button");e&&e.addEventListener("click",(e=>{e.preventDefault(),document.querySelector("#mp_checkout_type").value="wallet_button",r()}))}),[]),(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:_.params.content}})},h={name:w,label:(0,d.jsx)(y,{}),content:(0,d.jsx)(f,{}),edit:(0,d.jsx)(f,{}),canMakePayment:()=>!0,ariaLabel:S,supports:{features:null!==(p=_?.supports)&&void 0!==p?p:[]}};(0,t.registerPaymentMethod)(h)})();