(()=>{"use strict";var e={20:(e,t,o)=>{var r=o(609),n=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,o){var r,i={},u=null,m=null;for(r in void 0!==o&&(u=""+o),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(m=t.ref),t)s.call(t,r)&&!a.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:n,type:e,key:u,ref:m,props:i,_owner:c.current}}t.jsx=i,t.jsxs=i},609:e=>{e.exports=window.React},848:(e,t,o)=>{e.exports=o(20)}},t={};const o=window.wc.wcBlocksRegistry,r=window.wc.wcSettings,n=window.wp.element,s=window.wp.htmlEntities,c="mercadopago_blocks_update_cart";var a=function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}(848);const i=({text:e,imgSrc:t,id:o})=>(0,a.jsxs)("div",{id:o,className:"row-image-select",children:[(0,a.jsx)("img",{src:t}),(0,a.jsx)("p",{children:e})]});var u;const m="mp_checkout_blocks",p="woo-mercado-pago-custom",d=(0,r.getSetting)("woo-mercado-pago-custom_data",{}),l=(0,s.decodeEntities)(d.title)||"Checkout Custom",w=()=>{const e=(0,s.decodeEntities)(d?.params?.fee_title||""),t=`${l} ${e}`;return(0,a.jsx)(i,{text:t,imgSrc:d.params.icon})},y=e=>{(e=>{const{extensionCartUpdate:t}=wc.blocksCheckout,{eventRegistration:o,emitResponse:r}=e,{onPaymentSetup:s}=o;(0,n.useEffect)((()=>{((e,t)=>{e({namespace:c,data:{action:"add",gateway:t}})})(t,p);const e=s((()=>({type:r.responseTypes.SUCCESS})));return()=>(((e,t)=>{e({namespace:c,data:{action:"remove",gateway:t}})})(t,p),e())}),[s])})(e);const{eventRegistration:t,emitResponse:o,onSubmit:r}=e,{onPaymentSetup:s,onCheckoutSuccess:i,onCheckoutFail:u}=t;return(0,n.useEffect)((()=>{!async function(e,t){for(;!window.mpCustomCheckoutHandler;)await new Promise((e=>setTimeout(e,100)));const o=window.mpCustomCheckoutHandler,r=!!document.querySelector(".wc-block-components-spinner");o.cardForm.formMounted&&!r&&o.cardForm.form.unmount();const n=function(e,t){if(!Number.isInteger(e)||"object"!=typeof t)throw new Error("Invalid input");return(e/Math.pow(10,t.minorUnit)).toFixed(t.minorUnit).split(".").join(".")}(e,t);o.cardForm.initCardForm(n)}(e.billing.cartTotal.value,e.billing.currency)}),[e.billing.cartTotal.value]),(0,n.useEffect)((()=>{const e=s((async()=>{switch(document.querySelector("#mp_checkout_type")?.value){case"super_token":if(!window.mpSuperTokenPaymentMethods)return{type:o.responseTypes.ERROR};if(!window.mpSuperTokenPaymentMethods.isSelectedPaymentMethodValid())return window.mpSuperTokenPaymentMethods.forceShowValidationErrors(),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:o.responseTypes.ERROR};window.mpSuperTokenPaymentMethods.updateSecurityCode();break;case"wallet_button":break;default:try{const e=await window.mpCustomCheckoutHandler.cardForm.form.createCardToken();document.querySelector("#cardTokenId").value=e.token}catch(e){return console.warn("token creation error after submit: ",e),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:o.responseTypes.ERROR}}}const e=document.querySelector("#mercadopago-utilities"),t={};e&&e.querySelectorAll("input[name]").forEach((e=>{t[e.name]=e.value}));const r=document.querySelector("#form-checkout__identificationType"),n=document.querySelector("#form-checkout__identificationNumber");return r&&r.value&&(t["mercadopago_custom[doc_type]"]=r.value),n&&n.value&&(t["mercadopago_custom[doc_number]"]=n.value),{type:o.responseTypes.SUCCESS,meta:{paymentMethodData:t}}}));return()=>e()}),[s]),(0,n.useEffect)((()=>{const e=i((async e=>{const t=e.processingResponse,r=e.processingResponse.paymentDetails;if(r.three_ds_flow){const e=new Promise(((e,t)=>{window.addEventListener("completed_3ds",(o=>{o.detail.error&&t(o.detail.error),e()}))}));return window.mpCustomCheckoutHandler.threeDSHandler.load3DSFlow(r.last_four_digits),await e.then((()=>({type:o.responseTypes.SUCCESS}))).catch((e=>({type:o.responseTypes.FAIL,message:e,messageContext:o.noticeContexts.PAYMENTS})))}return sendMetric("MP_CUSTOM_BLOCKS_SUCCESS",t.paymentStatus,m),{type:o.responseTypes.SUCCESS}}));return()=>e()}),[i]),(0,n.useEffect)((()=>{const e=u((e=>{window.mpSuperTokenTriggerHandler?.resetSuperTokenOnError();const t=e.processingResponse;return sendMetric("MP_CUSTOM_BLOCKS_ERROR",t.paymentStatus,m),{type:o.responseTypes.FAIL,messageContext:o.noticeContexts.PAYMENTS,message:t.paymentDetails.message}}));return()=>e()}),[u]),(0,n.useEffect)((()=>{window.mpFormId="blocks_checkout_form",window.mpCheckoutForm=document.querySelector(".wc-block-components-form.wc-block-checkout__form"),window.mpCheckoutForm&&jQuery(window.mpCheckoutForm).prop("id",mpFormId);const e=document.getElementById("mp-wallet-button");e&&e.addEventListener("click",(e=>{e.preventDefault(),document.querySelector("#mp_checkout_type").value="wallet_button",r()}))}),[]),(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:d.params.content}})},S={name:p,label:(0,a.jsx)(w,{}),content:(0,a.jsx)(y,{}),edit:(0,a.jsx)(y,{}),canMakePayment:()=>!0,ariaLabel:l,supports:{features:null!==(u=d?.supports)&&void 0!==u?u:[]}};(0,o.registerPaymentMethod)(S)})();