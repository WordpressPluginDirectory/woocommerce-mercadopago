(()=>{"use strict";var e={20:(e,t,o)=>{var r=o(609),n=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,o){var r,i={},u=null,p=null;for(r in void 0!==o&&(u=""+o),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(p=t.ref),t)a.call(t,r)&&!s.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:n,type:e,key:u,ref:p,props:i,_owner:c.current}}t.jsx=i,t.jsxs=i},609:e=>{e.exports=window.React},848:(e,t,o)=>{e.exports=o(20)}},t={};const o=window.wc.wcBlocksRegistry,r=window.wc.wcSettings,n=window.wp.element,a=window.wp.htmlEntities,c="mercadopago_blocks_update_cart",s=(e,t)=>e({namespace:c,data:{action:"add",gateway:t}});var i=function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}(848);const u=({text:e,imgSrc:t,id:o})=>(0,i.jsxs)("div",{id:o,className:"row-image-select",children:[(0,i.jsx)("img",{src:t}),(0,i.jsx)("p",{children:e})]});var p;const d="mp_checkout_blocks",m="woo-mercado-pago-custom",l=(0,r.getSetting)("woo-mercado-pago-custom_data",{}),w=(0,a.decodeEntities)(l.title)||"Checkout Custom",y=()=>{const e=(0,a.decodeEntities)(l?.params?.fee_title||""),t=`${w} ${e}`;return(0,i.jsx)(u,{text:t,imgSrc:l.params.icon})},S=e=>{const{eventRegistration:t,emitResponse:o,onSubmit:r}=e,{onPaymentSetup:a,onCheckoutSuccess:u,onCheckoutFail:p}=t,[w,y]=(0,n.useState)(null),[S,f]=(0,n.useState)(!0),{extensionCartUpdate:h}=wc.blocksCheckout;return(0,n.useEffect)((()=>{S?window.mpCustomCheckoutHandler?.cardForm?.createLoadSpinner():window.mpCustomCheckoutHandler?.cardForm?.removeLoadSpinner()}),[S]),(0,n.useEffect)((()=>(s(h,m).then((e=>{y(e?.totals?.total_price)})).catch((e=>{console.error(e)})),()=>(((e,t)=>{e({namespace:c,data:{action:"remove",gateway:t}})})(h,m),a((()=>({type:o.responseTypes.SUCCESS})))()))),[a]),(0,n.useEffect)((()=>{e.billing.cartTotal.value==w?async function(e,t,o=1){for(;!window.mpCustomCheckoutHandler;)await new Promise((e=>setTimeout(e,100)));const r=window.mpCustomCheckoutHandler,n=!!document.querySelector(".wc-block-components-spinner");r.cardForm.formMounted&&!n&&r.cardForm.form.unmount();let a=function(e,t){if(!Number.isInteger(e)||"object"!=typeof t)throw new Error("Invalid input");return(e/Math.pow(10,t.minorUnit)).toFixed(t.minorUnit).split(".").join(".")}(e,t);const c=parseFloat(o);c>0&&(a=String(parseFloat(a)*c)),await r.cardForm.initCardForm(a)}(e.billing.cartTotal.value,e.billing.currency,l.params.currencyRatio).finally((()=>{f(!1)})):s(h,m).then((e=>{y(e?.totals?.total_price)})).catch((e=>{console.error(e)}))}),[e.billing.cartTotal.value,w]),(0,n.useEffect)((()=>{const e=a((async()=>{switch(document.querySelector("#mp_checkout_type")?.value){case"super_token":if(!window.mpSuperTokenPaymentMethods)return{type:o.responseTypes.ERROR};if(!window.mpSuperTokenPaymentMethods.isSelectedPaymentMethodValid())return window.mpSuperTokenPaymentMethods.forceShowValidationErrors(),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:o.responseTypes.ERROR};await window.mpSuperTokenPaymentMethods.updateSecurityCode();break;case"wallet_button":break;default:try{const e=await window.mpCustomCheckoutHandler.cardForm.form.createCardToken();document.querySelector("#cardTokenId").value=e.token}catch(e){return console.warn("token creation error after submit: ",e),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:o.responseTypes.ERROR}}if("undefined"!=typeof CheckoutPage&&!CheckoutPage.verifyInstallmentsContainer())return window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:o.responseTypes.ERROR}}const e=document.querySelector("#mercadopago-utilities"),t={};e&&e.querySelectorAll("input[name]").forEach((e=>{t[e.name]=e.value}));const r=document.querySelector("#form-checkout__identificationType"),n=document.querySelector("#form-checkout__identificationNumber");return r&&r.value&&(t["mercadopago_custom[doc_type]"]=r.value),n&&n.value&&(t["mercadopago_custom[doc_number]"]=n.value),{type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{...window.mpHiddenInputDataFromBlocksCheckout,...t}}}}));return()=>e()}),[a]),(0,n.useEffect)((()=>{const e=u((async e=>{const t=e.processingResponse,r=e.processingResponse.paymentDetails;if(r.three_ds_flow){const e=new Promise(((e,t)=>{window.addEventListener("completed_3ds",(o=>{o.detail.error&&t(o.detail.error),e()}))}));return window.mpCustomCheckoutHandler.threeDSHandler.load3DSFlow(r.last_four_digits),await e.then((()=>({type:o.responseTypes.SUCCESS}))).catch((e=>({type:o.responseTypes.FAIL,message:e,messageContext:o.noticeContexts.PAYMENTS})))}return sendMetric("MP_CUSTOM_BLOCKS_SUCCESS",t.paymentStatus,d),{type:o.responseTypes.SUCCESS}}));return()=>e()}),[u]),(0,n.useEffect)((()=>{const e=p((e=>{"undefined"!=typeof MPCheckoutErrorDispatcher&&MPCheckoutErrorDispatcher.dispatchEventWhenBlocksCheckoutErrorOccurred(e),window.mpSuperTokenTriggerHandler?.resetSuperTokenOnError();const t=e.processingResponse;return sendMetric("MP_CUSTOM_BLOCKS_ERROR",t.paymentStatus,d),{type:o.responseTypes.FAIL,messageContext:o.noticeContexts.PAYMENTS,message:t.paymentDetails.message}}));return()=>e()}),[p]),(0,n.useEffect)((()=>{f(!0),window.mpFormId="blocks_checkout_form",window.mpCheckoutForm=document.querySelector(".wc-block-components-form.wc-block-checkout__form"),window.mpCheckoutForm&&jQuery(window.mpCheckoutForm).prop("id",window.mpFormId);const e=document.getElementById("mp-wallet-button");e&&e.addEventListener("click",(e=>{e.preventDefault(),window.mpSuperTokenTriggerHandler?window.mpSuperTokenTriggerHandler.onTriggerWalletButton(r):(document.querySelector("#mp_checkout_type").value="wallet_button",r())}))}),[]),(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:l.params.content}})},f={name:m,label:(0,i.jsx)(y,{}),content:(0,i.jsx)(S,{}),edit:(0,i.jsx)(S,{}),canMakePayment:()=>!0,ariaLabel:w,supports:{features:null!==(p=l?.supports)&&void 0!==p?p:[]}};(0,o.registerPaymentMethod)(f)})();